(self.webpackChunkfirefox_ecosystem_platform=self.webpackChunkfirefox_ecosystem_platform||[]).push([[3108],{4802:function(e,n,t){"use strict";t.r(n),t.d(n,{frontMatter:function(){return r},contentTitle:function(){return c},metadata:function(){return u},toc:function(){return p},default:function(){return f}});var a=t(87462),o=t(63366),i=(t(67294),t(3905)),s=t(93456),l=["components"],r={id:"fxa-oauth-webchannel-protocol",title:"WebChannels in the Fenix browser & WebExtensions",sidebar_label:"WebChannels in Fenix & WebExtensions"},c=void 0,u={unversionedId:"fxa-engineering/fxa-oauth-webchannel-protocol",id:"fxa-engineering/fxa-oauth-webchannel-protocol",isDocsHomePage:!1,title:"WebChannels in the Fenix browser & WebExtensions",description:"Current as of December 2nd, 2019",source:"@site/docs/fxa-engineering/fxa-oauth-webchannel-protocol.md",sourceDirName:"fxa-engineering",slug:"/fxa-engineering/fxa-oauth-webchannel-protocol",permalink:"/ecosystem-platform/fxa-engineering/fxa-oauth-webchannel-protocol",editUrl:"https://github.com/mozilla/ecosystem-platform/edit/main/website/docs/fxa-engineering/fxa-oauth-webchannel-protocol.md",tags:[],version:"current",frontMatter:{id:"fxa-oauth-webchannel-protocol",title:"WebChannels in the Fenix browser & WebExtensions",sidebar_label:"WebChannels in Fenix & WebExtensions"},sidebar:"docs",previous:{title:"WebChannels in Desktop & Fennec",permalink:"/ecosystem-platform/fxa-engineering/fxa-webchannel-protocol"},next:{title:"Experiments & A/B testing",permalink:"/ecosystem-platform/fxa-engineering/fxa-content-server-ab-testing"}},p=[{value:"Communication with GeckoView applications",id:"communication-with-geckoview-applications",children:[]},{value:"Commands",id:"commands",children:[{value:"fxaccounts:fxa_status",id:"fxaccountsfxa_status",children:[]},{value:"fxaccounts:oauth_login",id:"fxaccountsoauth_login",children:[]}]},{value:"See also",id:"see-also",children:[]}],h={toc:p};function f(e){var n=e.components,t=(0,o.Z)(e,l);return(0,i.kt)("wrapper",(0,a.Z)({},h,t,{components:n,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"Current as of ",(0,i.kt)("inlineCode",{parentName:"p"},"December 2nd, 2019")),(0,i.kt)("h1",{id:"communication-with-oauth-webchannels"},"Communication with OAuth WebChannels"),(0,i.kt)("p",null,"OAuth WebChannels is an extension of the ",(0,i.kt)("a",{parentName:"p",href:"./fxa-webchannel-protocol"},"FxA WebChannel Desktop Flow"),".\nIt consists of similar messages as the Desktop Sync flow, however is more generic because of the use\nof OAuth in the background. Some behaviours in the OAuth flow are different."),(0,i.kt)("p",null,"This flow currently supports the following messages:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"fxaccounts:fxa_status")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"fxaccounts:oauth_login"))),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"fxaccounts:fxa_status")," message in the OAuth flow supports specifying a custom list of Sync engines that the app supports.\nSee ",(0,i.kt)("a",{parentName:"p",href:"./fxa-webchannel-protocol"},"FxA WebChannel Desktop Flow")," for details of engine capabilities."),(0,i.kt)("h2",{id:"communication-with-geckoview-applications"},"Communication with GeckoView applications"),(0,i.kt)("p",null,"To enable this feature in applications with GeckoView we ship a WebExtension\nas part of the ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/mozilla-mobile/android-components/blob/master/components/service/firefox-accounts/README.md"},"firefox-accounts")," Android component."),(0,i.kt)("p",null,"Communication channel is established from web content to this class via webextension, as follows:"),(0,i.kt)(s.Mermaid,{chart:"sequenceDiagram\n  participant fxa as FxA web content\n  participant glue as glue - fxawebchannel.js\n  participant webext as Web Extension\n\n  fxa--\x3e>glue: WebChannelMessageToChrome JS Event\n  glue--\x3e>webext: Port message\n  webext--\x3e>glue: Port message\n  glue--\x3e>fxa: WebChannelMessageToContent JS Event",mdxType:"Mermaid"}),(0,i.kt)(s.Mermaid,{chart:"sequenceDiagram\n  participant fxa as FxA web content\n  participant browser as Browser\n\n  fxa--\x3e>browser: fxa-status - request account status & device capabilities\n  browser--\x3e>fxa: response-based on state of [accountManager]\n  fxa->>fxa: user authenticates/authorizes\n  fxa--\x3e>browser: oauth-login - send OAuth code, state, syncEngine info",mdxType:"Mermaid"}),(0,i.kt)("h2",{id:"commands"},"Commands"),(0,i.kt)("h3",{id:"fxaccountsfxa_status"},"fxaccounts:fxa_status"),(0,i.kt)("p",null,"See the ",(0,i.kt)("a",{parentName:"p",href:"./fxa-webchannel-protocol#fxaccounts-fxa_status"},"fxaccounts:fxa_status section")," of the WebChannel Protocol document."),(0,i.kt)("h4",{id:"engines-capability"},(0,i.kt)("inlineCode",{parentName:"h4"},"engines")," capability"),(0,i.kt)("p",null,"Unlike the Desktop WebChannel integration, the OAuth WebChannel integration expects all supported\nengines to be enumerated within the ",(0,i.kt)("inlineCode",{parentName:"p"},"engines")," capability. Possible values are:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"addons")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"addresses")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"bookmarks")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"creditcards")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"history")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"passwords")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"preferences")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"tabs"))),(0,i.kt)("h3",{id:"fxaccountsoauth_login"},"fxaccounts:oauth_login"),(0,i.kt)("p",null,"Sent when a user successfully authenticates via a WebChannel OAuth flow."),(0,i.kt)("h4",{id:"data"},"data"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'{\n  "code": "02f3cfea84ac4c143662b38d6c7f0c82c6f91eb041befc7cecda446b1b4887c1",\n  "state": "vHao1p6OizzwReCkQMSpZA",\n  "redirect": "urn:ietf:wg:oauth:2.0:oob:oauth-redirect-webchannel",\n  "action": "signin",\n  "declinedSyncEngines": ["history"],\n  "offeredSyncEngines": ["history"]\n}\n')),(0,i.kt)("h4",{id:"support"},"support"),(0,i.kt)("p",null,"Supported by ",(0,i.kt)("inlineCode",{parentName:"p"},"oauth_webchannel_v1")," context."),(0,i.kt)("h2",{id:"see-also"},"See also"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"./fxa-webchannel-protocol"},"FxA WebChannel Desktop Flow"))))}f.isMDXComponent=!0},11748:function(e,n,t){var a={"./locale":89234,"./locale.js":89234};function o(e){var n=i(e);return t(n)}function i(e){if(!t.o(a,e)){var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}return a[e]}o.keys=function(){return Object.keys(a)},o.resolve=i,e.exports=o,o.id=11748}}]);