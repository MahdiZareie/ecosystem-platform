"use strict";(self.webpackChunkfirefox_ecosystem_platform=self.webpackChunkfirefox_ecosystem_platform||[]).push([[1451],{3905:function(e,t,n){n.d(t,{Zo:function(){return p},kt:function(){return d}});var o=n(67294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,o,i=function(e,t){if(null==e)return{};var n,o,i={},a=Object.keys(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var l=o.createContext({}),c=function(e){var t=o.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},p=function(e){var t=c(e.components);return o.createElement(l.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},m=o.forwardRef((function(e,t){var n=e.components,i=e.mdxType,a=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),m=c(n),d=i,g=m["".concat(l,".").concat(d)]||m[d]||u[d]||a;return n?o.createElement(g,r(r({ref:t},p),{},{components:n})):o.createElement(g,r({ref:t},p))}));function d(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var a=n.length,r=new Array(a);r[0]=m;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:i,r[1]=s;for(var c=2;c<a;c++)r[c]=n[c];return o.createElement.apply(null,r)}return o.createElement.apply(null,n)}m.displayName="MDXCreateElement"},44038:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return s},contentTitle:function(){return l},metadata:function(){return c},toc:function(){return p},default:function(){return m}});var o=n(87462),i=n(63366),a=(n(67294),n(3905)),r=["components"],s={id:"sync-testing",title:"Sync Testing",sidebar_label:"Sync Testing"},l=void 0,c={unversionedId:"platform/firefox-sync/sync-testing",id:"platform/firefox-sync/sync-testing",isDocsHomePage:!1,title:"Sync Testing",description:"Overview",source:"@site/docs/platform/firefox-sync/sync-testing.md",sourceDirName:"platform/firefox-sync",slug:"/platform/firefox-sync/sync-testing",permalink:"/ecosystem-platform/platform/firefox-sync/sync-testing",editUrl:"https://github.com/mozilla/ecosystem-platform/edit/main/website/docs/platform/firefox-sync/sync-testing.md",tags:[],version:"current",frontMatter:{id:"sync-testing",title:"Sync Testing",sidebar_label:"Sync Testing"},sidebar:"docs",previous:{title:"Account Management",permalink:"/ecosystem-platform/platform/firefox-sync/account-management-feature"},next:{title:"Using the Staging Environment",permalink:"/ecosystem-platform/platform/firefox-sync/using-the-staging-environment"}},p=[{value:"Overview",id:"overview",children:[]},{value:"Testing Against Specific Environments",id:"testing-against-specific-environments",children:[{value:"Development",id:"development",children:[]},{value:"Staging",id:"staging",children:[]}]},{value:"Testing Specific Sync Engines",id:"testing-specific-sync-engines",children:[{value:"Lockwise",id:"lockwise",children:[]}]},{value:"How do I...",id:"how-do-i",children:[]},{value:"...find my Sync id?",id:"find-my-sync-id",children:[]},{value:"...verify I&#39;ve set things up correctly?",id:"verify-ive-set-things-up-correctly",children:[]},{value:"...configure Sync logging?",id:"configure-sync-logging",children:[]},{value:"...get access to Spanner?",id:"get-access-to-spanner",children:[]},{value:"...know if my Firefox account is pointed to Spanner?",id:"know-if-my-firefox-account-is-pointed-to-spanner",children:[]},{value:"...disable caching for auth creds for Sync?",id:"disable-caching-for-auth-creds-for-sync",children:[]}],u={toc:p};function m(e){var t=e.components,n=(0,i.Z)(e,r);return(0,a.kt)("wrapper",(0,o.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h2",{id:"overview"},"Overview"),(0,a.kt)("p",null,"Testing Sync is complex; it involves testing multiple possible clients, engines, storage options, all against different environments. Configuring each of these can be time consuming; here's a cheat sheet to help you get up and running."),(0,a.kt)("h2",{id:"testing-against-specific-environments"},"Testing Against Specific Environments"),(0,a.kt)("p",null,"Note: these documents are all geared towards the newer ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/mozilla-services/syncstorage-rs"},"syncstorage-rs")," project. Until the legacy Sync server is retired, you can find detailed instructions on it's usage ",(0,a.kt)("a",{parentName:"p",href:"https://mozilla-services.readthedocs.io/en/latest/howtos/run-sync-1.5.html"},"here"),"."),(0,a.kt)("h3",{id:"development"},"Development"),(0,a.kt)("h4",{id:"desktop"},"Desktop"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"Use a production Firefox account."),(0,a.kt)("li",{parentName:"ol"},"Now, follow the instructions in the ",(0,a.kt)("a",{parentName:"li",href:"https://github.com/mozilla-services/syncstorage-rs#connecting-to-firefox"},"connecting to Firefox section")," of the README. It's recommended to test against ",(0,a.kt)("a",{parentName:"li",href:"https://github.com/mozilla-services/syncstorage-rs#mysql"},"MySQL"),", but if you're feeling adventurous, you can also try ",(0,a.kt)("a",{parentName:"li",href:"https://github.com/mozilla-services/syncstorage-rs#spanner"},"Spanner"),".")),(0,a.kt)("h3",{id:"staging"},"Staging"),(0,a.kt)("h4",{id:"desktop-1"},"Desktop"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"First, make sure you're using a ",(0,a.kt)("a",{parentName:"li",href:"/ecosystem-platform/docs/process/using-the-staging-environment#working-with-staging-firefox-accounts"},"staging Firefox account"),"."),(0,a.kt)("li",{parentName:"ol"},"Now, follow the instructions to ",(0,a.kt)("a",{parentName:"li",href:"#verify-ive-set-things-up-correctly"},"verify setup via a manual Sync"),".")),(0,a.kt)("h4",{id:"ios"},"iOS"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"Follow the instructions to ",(0,a.kt)("a",{parentName:"li",href:"/ecosystem-platform/docs/process/using-the-staging-environment#ios"},"point Firefox iOS to staging"),"."),(0,a.kt)("li",{parentName:"ol"},"Now, follow the instructions to ",(0,a.kt)("a",{parentName:"li",href:"#verify-ive-set-things-up-correctly"},"verify setup via a manual Sync"),".")),(0,a.kt)("h4",{id:"android"},"Android"),(0,a.kt)("p",null,"This is not currently possible for Fenix. See ",(0,a.kt)("a",{parentName:"p",href:"/ecosystem-platform/docs/process/using-the-staging-environment#android"},"using the staging environment")," for more details."),(0,a.kt)("h2",{id:"testing-specific-sync-engines"},"Testing Specific Sync Engines"),(0,a.kt)("p",null,'Sync engines are the term used for types of data that can be Synced. Ie, "bookmarks" is a different engine than "addresses", and so forth.'),(0,a.kt)("h3",{id:"lockwise"},"Lockwise"),(0,a.kt)("p",null,"Behind the scenes, ",(0,a.kt)("a",{parentName:"p",href:"https://www.mozilla.org/en-US/firefox/lockwise/"},"Lockwise")," uses Sync to share logins across devices."),(0,a.kt)("h4",{id:"desktop-2"},"Desktop"),(0,a.kt)("p",null,"Testing Lockwise in Desktop against staging follows ",(0,a.kt)("a",{parentName:"p",href:"/ecosystem-platform/docs/process/using-the-staging-environment#desktop"},"the same process as Desktop"),"."),(0,a.kt)("h4",{id:"ios-1"},"iOS"),(0,a.kt)("p",null,"Currently, Lockwise iOS requires a custom build to test against a custom Sync server. You can follow the feature request to get this added to the UI ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/mozilla-lockwise/lockwise-android/issues/1129"},"here"),". In the meantime, you'll need to create a local custom build for testing:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"First, you'll need to ",(0,a.kt)("a",{parentName:"li",href:"https://github.com/mozilla-lockwise/lockwise-ios/blob/master/docs/install.md"},"setup Lockwise iOS locally"),"."),(0,a.kt)("li",{parentName:"ol"},"Now, open ",(0,a.kt)("a",{parentName:"li",href:"https://github.com/mozilla-lockwise/lockwise-ios/blob/master/lockbox-ios/Store/AccountStore.swift"},"AccountStore.swift")," and change the ",(0,a.kt)("a",{parentName:"li",href:"https://github.com/mozilla-lockwise/lockwise-ios/blob/master/lockbox-ios/Store/AccountStore.swift#L122"},"config declaration")," from ",(0,a.kt)("inlineCode",{parentName:"li"},"FxAConfig.release")," to ",(0,a.kt)("inlineCode",{parentName:"li"},"FxAConfig.dev"),". "),(0,a.kt)("li",{parentName:"ol"},"Re-build the lockbox scheme in Xcode (Product > Build)."),(0,a.kt)("li",{parentName:"ol"},"Open the XCode Simulator, and login using an existing ",(0,a.kt)("a",{parentName:"li",href:"/ecosystem-platform/docs/process/using-the-staging-environment#working-with-staging-firefox-accounts"},"staging Firefox account"),"."),(0,a.kt)("li",{parentName:"ol"},"Test adding a new login on Desktop (pointed to staging) Lockwise."),(0,a.kt)("li",{parentName:"ol"},"Now, in the XCode Simulator force a Sync by pulling down on the list of logins.")),(0,a.kt)("h4",{id:"android-1"},"Android"),(0,a.kt)("p",null,"Currently, Lockwise Android requires a custom build to test against a custom Sync server. You can follow the feature request to get this added to the UI ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/mozilla-lockwise/lockwise-ios/issues/1175"},"here"),". In the meantime, you'll need to create a local custom build for testing:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"First, you'll need to ",(0,a.kt)("a",{parentName:"li",href:"https://github.com/mozilla-lockwise/lockwise-android/blob/master/docs/install.md"},"setup Lockwise for Android locally"),". Make sure to at least open the project in ",(0,a.kt)("a",{parentName:"li",href:"https://developer.android.com/studio/install"},"Android Studio")," once, which will force it to install the correct dependencies."),(0,a.kt)("li",{parentName:"ol"},"Now, open ",(0,a.kt)("a",{parentName:"li",href:"https://github.com/mozilla-lockwise/lockwise-android/blob/master/app/src/main/java/mozilla/lockbox/store/AccountStore.kt"},"AccountStore.kt")," and change the ",(0,a.kt)("a",{parentName:"li",href:"https://github.com/mozilla-lockwise/lockwise-android/blob/master/app/src/main/java/mozilla/lockbox/store/AccountStore.kt#L269"},"config declaration")," from ",(0,a.kt)("inlineCode",{parentName:"li"},"ServerConfig.release")," to ",(0,a.kt)("inlineCode",{parentName:"li"},"ServerConfig.dev"),"."),(0,a.kt)("li",{parentName:"ol"},"Rebuild the project in Android Studio (Build > Make Project)."),(0,a.kt)("li",{parentName:"ol"},"Now, open the ",(0,a.kt)("a",{parentName:"li",href:"https://developer.android.com/studio/run/managing-avds"},"Android Virtual Device Manager")," within Android Studio, and make sure you have a device downloaded."),(0,a.kt)("li",{parentName:"ol"},"Open your device in the ",(0,a.kt)("a",{parentName:"li",href:"https://developer.android.com/studio/run/emulator"},"Android Studio Emulator"),", and login using an existing ",(0,a.kt)("a",{parentName:"li",href:"/ecosystem-platform/docs/process/using-the-staging-environment#working-with-staging-firefox-accounts"},"staging Firefox account"),". If you've previously logged in using this virtual device while pointed to production, you may need to download a new device to bypass auth caching.")),(0,a.kt)("h2",{id:"how-do-i"},"How do I..."),(0,a.kt)("h2",{id:"find-my-sync-id"},"...find my Sync id?"),(0,a.kt)("p",null,"Each Firefox account has a unique Sync id associated with it. There's a few different ways to find it:"),(0,a.kt)("h4",{id:"via-the-browser-console"},"via the Browser Console:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"First, make sure that the Browser Console (different than Developer Tools Console) is enabled. Open the ",(0,a.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Tools/Settings"},"Developer Tools Settings")," (Desktop menu: Tools > Web Developer > Toggle Tools > \u201c\u2026\u201d > Settings), and check the \u201cEnable browser chrome and add-on debugging toolboxes\u201d setting in the \u201cAdvanced settings\u201d section.")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"In ",(0,a.kt)("inlineCode",{parentName:"p"},"about:config"),", set ",(0,a.kt)("inlineCode",{parentName:"p"},"devtools.chrome.enabled")," to ",(0,a.kt)("inlineCode",{parentName:"p"},"true"),". This will allow you to type into the Browser Console.")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Now, manually Sync (Account Menu > Sync Now).")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Open the Browser Console (Tools > Web Developer > Browser Console) and type ",(0,a.kt)("inlineCode",{parentName:"p"},"Weave.Service.clusterURL"),". "),(0,a.kt)("p",{parentName:"li"},"You should see something similar to ",(0,a.kt)("inlineCode",{parentName:"p"},"https://sync-3-us-east-1.stage.mozaws.net/1.5/0000000/"),", where ",(0,a.kt)("inlineCode",{parentName:"p"},"0000000")," corresponds to your Sync Id."))),(0,a.kt)("h4",{id:"via-sync-logs"},"via Sync Logs:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"First, verify that you've configured your Sync logs to ",(0,a.kt)("a",{parentName:"p",href:"#configure-sync-logging"},"log successful Syncs"),".")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Now, manually Sync (Account Menu > Sync Now).")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Now, ",(0,a.kt)("a",{parentName:"p",href:"#configure-sync-logging"},"browse to your Sync logs"),", and open the most recent one. Scan through it for something that looks like this: ",(0,a.kt)("inlineCode",{parentName:"p"},"POST success 200 https://sync-3-us-east-1.stage.mozaws.net/1.5/0000000/storage/tabs?batch=true&commit=true"),". The ",(0,a.kt)("inlineCode",{parentName:"p"},"0000000")," will correspond to your Sync Id."))),(0,a.kt)("h2",{id:"verify-ive-set-things-up-correctly"},"...verify I've set things up correctly?"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"In Desktop, manually Sync (Account Menu > Sync Now).")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Open your ",(0,a.kt)("a",{parentName:"p",href:"#configure-sync-logging"},"Sync logs")," to verify that you're syncing to the correct host. Sometimes, you'll need to restart Firefox after making a change to the Sync host in order for your new host to register correctly. Scan through the logs for something that looks like this:\n",(0,a.kt)("inlineCode",{parentName:"p"},"POST success 200 https://sync-3-us-east-1.stage.mozaws.net/1.5/0000000/storage/tabs?batch=true&commit=true.")),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"For ",(0,a.kt)("strong",{parentName:"p"},"production"),", your sync host will look like this:"),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"sync-<id-number>-<gcp-region>-g.sync.services.mozilla.com")," ie, ",(0,a.kt)("inlineCode",{parentName:"li"},"https://sync-1-us-east-1.sync.services.mozilla.com")," (GCP)"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"sync-<id-number>-<aws-region>.sync.service.mozilla.com")," ie, ",(0,a.kt)("inlineCode",{parentName:"li"},"https://sync-1-us-west1-g.sync.services.mozilla.com")," (AWS - Legacy) "))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"For ",(0,a.kt)("strong",{parentName:"p"},"staging"),", your sync host will look like this: "),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"https://stage.sync.nonprod.cloudops.mozgcp.net")," (GCP)"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"https://sync-3-us-east-1.stage.mozaws.net")," (AWS - Legacy)"))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"For ",(0,a.kt)("strong",{parentName:"p"},"development"),", you should see ",(0,a.kt)("inlineCode",{parentName:"p"},"localhost:PORT")," for your sync host."))))),(0,a.kt)("h2",{id:"configure-sync-logging"},"...configure Sync logging?"),(0,a.kt)("p",null,"Open ",(0,a.kt)("inlineCode",{parentName:"p"},"about:sync-log")," to see all your Sync logs."),(0,a.kt)("h4",{id:"log-output-for-successful-syncs"},"log output for successful Syncs:"),(0,a.kt)("p",null,"By default, sync logs are setup to log only errors. You can force successful syncs to output log info as well by:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"Open ",(0,a.kt)("inlineCode",{parentName:"li"},"about:config"),"."),(0,a.kt)("li",{parentName:"ol"},"Set ",(0,a.kt)("inlineCode",{parentName:"li"},"services.sync.log.appender.file.logOnSuccess")," to ",(0,a.kt)("inlineCode",{parentName:"li"},"true"),".")),(0,a.kt)("h4",{id:"enable-trace-logging"},"enable trace logging:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"First, download and install the ",(0,a.kt)("a",{parentName:"li",href:"https://addons.mozilla.org/en-US/firefox/addon/about-sync/"},"about-sync")," add-on."),(0,a.kt)("li",{parentName:"ol"},"Then, open ",(0,a.kt)("inlineCode",{parentName:"li"},"about:sync"),' and from the "General Options" menu, select ',(0,a.kt)("inlineCode",{parentName:"li"},"Actively looking for issues and want detailed logging"),".")),(0,a.kt)("h2",{id:"get-access-to-spanner"},"...get access to Spanner?"),(0,a.kt)("p",null,"This is currently a manual process. Contact ",(0,a.kt)("a",{href:"mailto:servicesengineering@mozilla.com"},"services engineering")," for more information."),(0,a.kt)("h2",{id:"know-if-my-firefox-account-is-pointed-to-spanner"},"...know if my Firefox account is pointed to Spanner?"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"Follow the instructions to get your ",(0,a.kt)("a",{parentName:"li",href:"#verify-ive-set-things-up-correctly"},"Sync host")," above, and then paste it into a browser followed by ",(0,a.kt)("inlineCode",{parentName:"li"},"__version__"),", ie: ",(0,a.kt)("inlineCode",{parentName:"li"},"https://sync-3-us-east-1.stage.mozaws.net/__version__"),". If you see a ",(0,a.kt)("inlineCode",{parentName:"li"},"0"),", you're using MySQL. If you see more detailed JSON including a ",(0,a.kt)("inlineCode",{parentName:"li"},"source")," value of ",(0,a.kt)("inlineCode",{parentName:"li"},"https://github.com/mozilla-services/syncstorage-rs"),", you're pointed to Spanner.")),(0,a.kt)("h2",{id:"disable-caching-for-auth-creds-for-sync"},"...disable caching for auth creds for Sync?"),(0,a.kt)("p",null,"This can be useful if you're making changes to auth servers while testing Sync. There's a flag called ",(0,a.kt)("inlineCode",{parentName:"p"},"services.sync.debug.ignoreCachedAuthCredentials")," that you can set to ",(0,a.kt)("inlineCode",{parentName:"p"},"true"),"."))}m.isMDXComponent=!0}}]);