"use strict";(self.webpackChunkfirefox_ecosystem_platform=self.webpackChunkfirefox_ecosystem_platform||[]).push([[3326],{3905:function(e,t,n){n.d(t,{Zo:function(){return d},kt:function(){return p}});var r=n(67294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var s=r.createContext({}),c=function(e){var t=r.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):a(a({},t),e)),n},d=function(e){var t=c(e.components);return r.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},m=r.forwardRef((function(e,t){var n=e.components,o=e.mdxType,i=e.originalType,s=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),m=c(n),p=o,v=m["".concat(s,".").concat(p)]||m[p]||u[p]||i;return n?r.createElement(v,a(a({ref:t},d),{},{components:n})):r.createElement(v,a({ref:t},d))}));function p(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var i=n.length,a=new Array(i);a[0]=m;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:o,a[1]=l;for(var c=2;c<i;c++)a[c]=n[c];return r.createElement.apply(null,a)}return r.createElement.apply(null,n)}m.displayName="MDXCreateElement"},33949:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return l},contentTitle:function(){return s},metadata:function(){return c},toc:function(){return d},default:function(){return m}});var r=n(87462),o=n(63366),i=(n(67294),n(3905)),a=["components"],l={title:"Working with Metrics"},s=void 0,c={unversionedId:"how-tos/working-with-metrics",id:"how-tos/working-with-metrics",title:"Working with Metrics",description:"Last updated: March 21st, 2022",source:"@site/docs/how-tos/working-with-metrics.md",sourceDirName:"how-tos",slug:"/how-tos/working-with-metrics",permalink:"/ecosystem-platform/how-tos/working-with-metrics",editUrl:"https://github.com/mozilla/ecosystem-platform/edit/master/docs/how-tos/working-with-metrics.md",tags:[],version:"current",frontMatter:{title:"Working with Metrics"},sidebar:"docs",previous:{title:"Using a Custom Profile with Firefox",permalink:"/ecosystem-platform/how-tos/using-a-custom-profile-with-firefox"},next:{title:"Using Sentry.io for Local Development",permalink:"/ecosystem-platform/how-tos/using-sentry-locally"}},d=[{value:"...create a new activity event?",id:"create-a-new-activity-event",children:[],level:2},{value:"...create a new flow event?",id:"create-a-new-flow-event",children:[{value:"Auth server",id:"auth-server",children:[],level:3},{value:"Content server",id:"content-server",children:[],level:3}],level:2},{value:"...create a new email event?",id:"create-a-new-email-event",children:[],level:2},{value:"...create a new Amplitude event?",id:"create-a-new-amplitude-event",children:[{value:"Auth server",id:"auth-server-1",children:[],level:3},{value:"Content server",id:"content-server-1",children:[],level:3}],level:2}],u={toc:d};function m(e){var t=e.components,n=(0,o.Z)(e,a);return(0,i.kt)("wrapper",(0,r.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"Last updated: ",(0,i.kt)("inlineCode",{parentName:"p"},"March 21st, 2022")),(0,i.kt)("p",null,"Other relevant documents include our ",(0,i.kt)("a",{parentName:"p",href:"../reference/metrics"},"metrics reference")," and ",(0,i.kt)("a",{parentName:"p",href:"../explanation/metrics"},"metrics explanation"),"."),(0,i.kt)("h1",{id:"how-do-i"},"How do I..."),(0,i.kt)("h2",{id:"create-a-new-activity-event"},"...create a new activity event?"),(0,i.kt)("ol",{start:0},(0,i.kt)("li",{parentName:"ol"},"Add the event name to ",(0,i.kt)("inlineCode",{parentName:"li"},"ACTIVITY_EVENTS")," in ",(0,i.kt)("inlineCode",{parentName:"li"},"lib/metrics/events.js"),". Unless it\u2019s also a flow event (most new events will be one or the other), you should also add it to ",(0,i.kt)("inlineCode",{parentName:"li"},"NOT_FLOW_EVENTS")," in the same module."),(0,i.kt)("li",{parentName:"ol"},"Emit the new event in code like ",(0,i.kt)("inlineCode",{parentName:"li"},"request.emitMetricsEvent('foo.bar', { uid })"),"."),(0,i.kt)("li",{parentName:"ol"},"Wherever you emit it, add test cases to cover that the event is correctly logged.")),(0,i.kt)("h2",{id:"create-a-new-flow-event"},"...create a new flow event?"),(0,i.kt)("h3",{id:"auth-server"},"Auth server"),(0,i.kt)("ol",{start:0},(0,i.kt)("li",{parentName:"ol"},"Emit the new event in code like ",(0,i.kt)("inlineCode",{parentName:"li"},"request.emitMetricsEvent('foo.bar')"),"."),(0,i.kt)("li",{parentName:"ol"},"Wherever you emit it, add test cases to cover that the event is correctly logged."),(0,i.kt)("li",{parentName:"ol"},"Be aware that flow events are only emitted if you have a ",(0,i.kt)("inlineCode",{parentName:"li"},"metricsContext"),". If there\u2019s one in the payload for the current route, you\u2019re all good. If not, the code will try to read one from memcached for you. But a previous call to ",(0,i.kt)("inlineCode",{parentName:"li"},"request.stashMetricsContext")," or ",(0,i.kt)("inlineCode",{parentName:"li"},"request.propagateMetricsContext")," will need to have been made with the token that your request is authenticated by. Maybe that\u2019s done already, maybe it isn\u2019t, you\u2019ll need to trace the request flow and grep the code.")),(0,i.kt)("h3",{id:"content-server"},"Content server"),(0,i.kt)("ol",{start:0},(0,i.kt)("li",{parentName:"ol"},"On the front-end, make sure your view has mixed in ",(0,i.kt)("inlineCode",{parentName:"li"},"FlowEventsMixin"),"."),(0,i.kt)("li",{parentName:"ol"},"view and engage events will be emitted automatically when you add the mixin, for other events you need to call ",(0,i.kt)("inlineCode",{parentName:"li"},"this.logFlowEvent")," from your view."),(0,i.kt)("li",{parentName:"ol"},"Add test coverage for the new event to your view unit tests.")),(0,i.kt)("h2",{id:"create-a-new-email-event"},"...create a new email event?"),(0,i.kt)("p",null,"You don\u2019t need to do this, it\u2019s all set up to work automatically."),(0,i.kt)("h2",{id:"create-a-new-amplitude-event"},"...create a new Amplitude event?"),(0,i.kt)("h3",{id:"auth-server-1"},"Auth server"),(0,i.kt)("ol",{start:0},(0,i.kt)("li",{parentName:"ol"},"Amplitude events are all triggered by activity or flow events, so the first step is to ensure there\u2019s one of those (see above if you need to create a new one)."),(0,i.kt)("li",{parentName:"ol"},"If you\u2019re triggering from a specific event, add a new mapping to the ",(0,i.kt)("inlineCode",{parentName:"li"},"EVENTS")," object in ",(0,i.kt)("inlineCode",{parentName:"li"},"lib/metrics/amplitude.js"),". If you\u2019re triggering from a set of events, add a mapping to ",(0,i.kt)("inlineCode",{parentName:"li"},"FUZZY_EVENTS")," instead."),(0,i.kt)("li",{parentName:"ol"},"Add a new test case for the new event to ",(0,i.kt)("inlineCode",{parentName:"li"},"test/local/metrics/amplitude.js"),". Every event should have its own test case in that module.")),(0,i.kt)("h3",{id:"content-server-1"},"Content server"),(0,i.kt)("ol",{start:0},(0,i.kt)("li",{parentName:"ol"},"Amplitude events are all triggered by flow or screen events, so the first step is to ensure there\u2019s one of those (see above if you need to create a new flow event)."),(0,i.kt)("li",{parentName:"ol"},"If you\u2019re triggering from a specific event, add a new mapping to the ",(0,i.kt)("inlineCode",{parentName:"li"},"EVENTS")," object in ",(0,i.kt)("inlineCode",{parentName:"li"},"server/lib/amplitude.js"),". If you\u2019re triggering from a set of events, add a mapping to ",(0,i.kt)("inlineCode",{parentName:"li"},"FUZZY_EVENTS")," instead."),(0,i.kt)("li",{parentName:"ol"},"Add a new test case for the new event to ",(0,i.kt)("inlineCode",{parentName:"li"},"tests/server/amplitude.js"),". Every event should have its own test case in that module.")))}m.isMDXComponent=!0}}]);