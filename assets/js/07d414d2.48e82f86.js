"use strict";(self.webpackChunkfirefox_ecosystem_platform=self.webpackChunkfirefox_ecosystem_platform||[]).push([[7647],{74942:(e,t,i)=>{i.r(t),i.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>p,frontMatter:()=>n,metadata:()=>s,toc:()=>u});var r=i(87462),a=(i(67294),i(3905));i(8209);const n={title:"Requirements for Integration",sidebar_label:"Integration Requirements"},o=void 0,s={unversionedId:"relying-parties/reference/integration-requirements",id:"relying-parties/reference/integration-requirements",title:"Requirements for Integration",description:"Last updated: June 8th, 2023",source:"@site/docs/relying-parties/reference/integration-requirements.md",sourceDirName:"relying-parties/reference",slug:"/relying-parties/reference/integration-requirements",permalink:"/ecosystem-platform/relying-parties/reference/integration-requirements",draft:!1,editUrl:"https://github.com/mozilla/ecosystem-platform/edit/master/docs/relying-parties/reference/integration-requirements.md",tags:[],version:"current",frontMatter:{title:"Requirements for Integration",sidebar_label:"Integration Requirements"},sidebar:"docs",previous:{title:"Device Registration (Sync)",permalink:"/ecosystem-platform/relying-parties/how-tos/device-registration"},next:{title:"Metrics",permalink:"/ecosystem-platform/relying-parties/reference/metrics-for-relying-parties"}},l={},u=[{value:"Maintain a point of contact",id:"maintain-a-point-of-contact",level:2},{value:"Subscribe to and process events",id:"subscribe-to-and-process-events",level:2},{value:"Respect API backoff headers",id:"respect-api-backoff-headers",level:2},{value:"Practice Good User Data Hygiene",id:"practice-good-user-data-hygiene",level:2},{value:"Self Hosted Login Flow",id:"self-hosted-login-flow",level:2}],c={toc:u};function p(e){let{components:t,...i}=e;return(0,a.kt)("wrapper",(0,r.Z)({},c,i,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"Last updated: ",(0,a.kt)("inlineCode",{parentName:"p"},"June 8th, 2023")),(0,a.kt)("h2",{id:"maintain-a-point-of-contact"},"Maintain a point of contact"),(0,a.kt)("p",null,"We communicate with our relying parties via the ",(0,a.kt)("a",{parentName:"p",href:"https://groups.google.com/a/mozilla.com/g/firefox-accounts-notices"},"firefox-accounts-notices group"),".  You must subscribe to this list."),(0,a.kt)("h2",{id:"subscribe-to-and-process-events"},"Subscribe to and process events"),(0,a.kt)("p",null,"Firefox accounts maintains an ",(0,a.kt)("a",{parentName:"p",href:"/relying-parties/tutorials/integration-with-fxa#webhook-events"},"event broker which is a webhook delivery system to communicate with relying parties"),".  You must ",(0,a.kt)("a",{parentName:"p",href:"/relying-parties/tutorials/integration-with-fxa#register-for-webhooks"},"register an endpoint to receive events"),".  You will receive events you may or may not care about but some events require you to perform actions:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"A user opts out of metrics")," (the ",(0,a.kt)("inlineCode",{parentName:"li"},"metricsEnabled")," boolean in the profile):  When this is ",(0,a.kt)("inlineCode",{parentName:"li"},"false")," you must not collect any metrics tied to the user.  Any existing metrics should be deleted.  This boolean should be checked each time a profile is requested."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"A user deletes their account")," (event ",(0,a.kt)("inlineCode",{parentName:"li"},"https://schemas.accounts.firefox.com/event/delete-user"),"):  The relying party must delete all user records for the deleted user.")),(0,a.kt)("h2",{id:"respect-api-backoff-headers"},"Respect API backoff headers"),(0,a.kt)("p",null,"Please see ",(0,a.kt)("a",{parentName:"p",href:"/relying-parties/reference/using-apis"},"this section on rate limits"),"."),(0,a.kt)("h2",{id:"practice-good-user-data-hygiene"},"Practice Good User Data Hygiene"),(0,a.kt)("ol",{start:0},(0,a.kt)("li",{parentName:"ol"},"Accounts should use uid rather than email address as the primary key. An account\u2019s primary email address can change."),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("a",{parentName:"li",href:"https://github.com/mozilla/fxa/tree/main/packages/fxa-event-broker#profile-change"},"Primary email changed notifications")," should update the contact email stored with the account."),(0,a.kt)("li",{parentName:"ol"},"Profile information should not be shared with 3rd parties without explicit consent."),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("a",{parentName:"li",href:"/api#tag/Oauth/operation/postOauthDestroy"},"Destroy any outstanding access tokens and refresh tokens")," whenever a user signals their session or account should be terminated, e.g., the user signs out of your site, closes their account on your site, or unsubscribes from all functionality.")),(0,a.kt)("h2",{id:"self-hosted-login-flow"},"Self Hosted Login Flow"),(0,a.kt)("p",null,"If you're hosting your own login page you need to send top-of-funnel metrics to FxA:"),(0,a.kt)("ol",{start:0},(0,a.kt)("li",{parentName:"ol"},"Initialize top of funnel metrics by calling ","[/metrics-flow request][metrics-flow-request]"," with the required query parameters:",(0,a.kt)("ol",{parentName:"li"},(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("inlineCode",{parentName:"li"},"entrypoint")," This is a string identifying the source of the request and should be agreed upon by the Firefox Accounts team."),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("inlineCode",{parentName:"li"},"form_type")," This is either ",(0,a.kt)("inlineCode",{parentName:"li"},"email")," (you have an input on your form for an email address) or ",(0,a.kt)("inlineCode",{parentName:"li"},"button")," (you just have a 'sign in' button)"),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("inlineCode",{parentName:"li"},"utm_source")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("inlineCode",{parentName:"li"},"utm_campaign")))),(0,a.kt)("li",{parentName:"ol"},"Propagate the ",(0,a.kt)("inlineCode",{parentName:"li"},"email"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"flow_id")," and ",(0,a.kt)("inlineCode",{parentName:"li"},"flow_begin_time")," query parameters, which are returned from the ","[/metrics-flow request][metrics-flow-request]",", in the request to ",(0,a.kt)("inlineCode",{parentName:"li"},"/authentication"),".")),(0,a.kt)("p",null,"To test without CORS errors your test application must have one of the following URLs:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"http://127.0.0.1:8001"},"http://127.0.0.1:8001")),(0,a.kt)("li",{parentName:"ul"},"http://localhost:8000"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"http://127.0.0.1:8000"},"http://127.0.0.1:8000")),(0,a.kt)("li",{parentName:"ul"},"Or be in the ",(0,a.kt)("inlineCode",{parentName:"li"},"ALLOWED_METRICS_FLOW_ORIGINS")," list (used for production entities)")))}p.isMDXComponent=!0}}]);