"use strict";(self.webpackChunkfirefox_ecosystem_platform=self.webpackChunkfirefox_ecosystem_platform||[]).push([[3659],{65207:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>s,default:()=>d,frontMatter:()=>i,metadata:()=>a,toc:()=>p});var o=n(87462),r=(n(67294),n(3905));n(16758);const i={id:"end-to-end-encryption",title:"End-to-end encryption",sidebar_label:"End-to-end Encryption"},s=void 0,a={unversionedId:"relying-parties/how-twos/end-to-end-encryption",id:"relying-parties/how-twos/end-to-end-encryption",title:"End-to-end encryption",description:"Firefox Accounts offers an end-to-end encryption support feature for OAuth reliers by deriving a strong encryption key from user's password. Keep in mind that Firefox Accounts does not provide a storage solution, it is up to you to use the generated key and encrypt the data with that key.",source:"@site/docs/relying-parties/how-twos/end-to-end-encryption.md",sourceDirName:"relying-parties/how-twos",slug:"/relying-parties/how-twos/end-to-end-encryption",permalink:"/ecosystem-platform/relying-parties/how-twos/end-to-end-encryption",draft:!1,editUrl:"https://github.com/mozilla/ecosystem-platform/edit/master/docs/relying-parties/how-twos/end-to-end-encryption.md",tags:[],version:"current",frontMatter:{id:"end-to-end-encryption",title:"End-to-end encryption",sidebar_label:"End-to-end Encryption"},sidebar:"docs",previous:{title:"Pairing authentication",permalink:"/ecosystem-platform/relying-parties/tutorials/pairing"},next:{title:"Metrics",permalink:"/ecosystem-platform/relying-parties/reference/metrics-for-relying-parties"}},l={},p=[{value:"WebExtensions",id:"webextensions",level:3},{value:"Examples",id:"examples",level:3}],c={toc:p};function d(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,o.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"Firefox Accounts offers an end-to-end encryption support feature for OAuth reliers by deriving a strong encryption key from user's password. Keep in mind that Firefox Accounts does not provide a storage solution, it is up to you to use the generated key and encrypt the data with that key."),(0,r.kt)("h3",{id:"webextensions"},"WebExtensions"),(0,r.kt)("p",null,"To use this feature in WebExtensions you need to do the following:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("a",{parentName:"li",href:"https://developer.mozilla.org/en-US/docs/Mozilla/Tech/Firefox_Accounts/Introduction#OAuth_2.0_API"},"Register an OAuth client")," and an OAuth app scope with Firefox Accounts"),(0,r.kt)("li",{parentName:"ol"},"Install the ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/mozilla/fxa-crypto-relier"},"fxa-crypto-relier")," library into your WebExtension"),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/mozilla/fxa-crypto-relier/tree/master/docs"},"Follow the documentation")," to trigger the Firefox Accounts login screen"),(0,r.kt)("li",{parentName:"ol"},"Consume the derived key after the successful login")),(0,r.kt)("h3",{id:"examples"},"Examples"),(0,r.kt)("p",null,"You can find an example of this feature in the ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/mozilla/notes/blob/5be89e52956182e57356b7ba9102d57cdb72be6f/src/background.js#L53-L72"},"TestPilot Notes source code"),". Here's a simplified diagram of a scoped key generated for a WebExtension:"),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://www.lucidchart.com/publicSegments/view/53ce9405-4ab6-481f-b8fe-0d47c0d29723/image.jpeg",alt:null})),(0,r.kt)("p",null,"An example of a key generated by Firefox Accounts: "),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://i.imgur.com/GdXHWVu.jpg",alt:null})),(0,r.kt)("p",null,"The generated key can be imported using existing WebCrypto APIs:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"function shared_key(key) {\n  return crypto.subtle.importKey(\n    'jwk',\n    { kty: key.kty, k: key.k.replace(/=/, '') },\n    'AES-KW',\n    true,\n    ['wrapKey', 'unwrapKey']\n  );\n}\n")))}d.isMDXComponent=!0}}]);