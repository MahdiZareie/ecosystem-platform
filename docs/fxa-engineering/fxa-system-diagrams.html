<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Maps of the FxA Universe · Firefox Ecosystem Platform</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="Current as of `November 15th, 2019`"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Maps of the FxA Universe · Firefox Ecosystem Platform"/><meta property="og:type" content="website"/><meta property="og:url" content="https://mozilla.github.io/ecosystem-platform/"/><meta property="og:description" content="Current as of `November 15th, 2019`"/><meta name="twitter:card" content="summary"/><link rel="shortcut icon" href="/ecosystem-platform/img/fx-master-brand.png"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script src="/ecosystem-platform/js/scrollSpy.js"></script><link rel="stylesheet" href="/ecosystem-platform/css/main.css"/><script src="/ecosystem-platform/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/ecosystem-platform/"><img class="logo" src="/ecosystem-platform/img/fx-master-brand.png" alt="Firefox Ecosystem Platform"/><h2 class="headerTitleWithLogo">Firefox Ecosystem Platform</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/ecosystem-platform/docs/welcome" target="_self">Docs</a></li><li class=""><a href="https://github.com/mozilla/ecosystem-platform" target="_self">GitHub</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>For FxA Engineers</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Introduction</h3><ul class=""><li class="navListItem"><a class="navItem" href="/ecosystem-platform/docs/welcome">Welcome</a></li><li class="navListItem"><a class="navItem" href="/ecosystem-platform/docs/platform-overview">Platform Overview</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">The Process</h3><ul class=""><li class="navListItem"><a class="navItem" href="/ecosystem-platform/docs/process/integration-with-fxa">Integration with FxA</a></li><li class="navListItem"><a class="navItem" href="/ecosystem-platform/docs/process/integration-with-subscription-platform">Integration with Subscription Platform</a></li><li class="navListItem"><a class="navItem" href="/ecosystem-platform/docs/process/becoming-a-sync-client">Becoming A Sync Client</a></li><li class="navListItem"><a class="navItem" href="/ecosystem-platform/docs/process/sync-testing">Sync Testing</a></li><li class="navListItem"><a class="navItem" href="/ecosystem-platform/docs/process/using-the-staging-environment">Using the Staging Environment</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Platform Features</h3><ul class=""><li class="navListItem"><a class="navItem" href="/ecosystem-platform/docs/features/features">Overview</a></li><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Firefox Account Management</h4><ul><li class="navListItem"><a class="navItem" href="/ecosystem-platform/docs/features/fxa-details/fxa-features-overview">Overview</a></li><li class="navListItem"><a class="navItem" href="/ecosystem-platform/docs/features/fxa-details/feature-detail-example">Feature Detail Example</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Subscription Management</h4><ul><li class="navListItem"><a class="navItem" href="/ecosystem-platform/docs/features/subscription-platform-details/subscription-platform-features">Overview</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Firefox Sync</h4><ul><li class="navListItem"><a class="navItem" href="/ecosystem-platform/docs/features/firefox-sync/sync-feature">Overview</a></li><li class="navListItem"><a class="navItem" href="/ecosystem-platform/docs/features/firefox-sync/password-management-feature">Password Management and Syncing</a></li><li class="navListItem"><a class="navItem" href="/ecosystem-platform/docs/features/firefox-sync/bookmarks-feature">Bookmarks</a></li><li class="navListItem"><a class="navItem" href="/ecosystem-platform/docs/features/firefox-sync/storage-feature">Storage</a></li><li class="navListItem"><a class="navItem" href="/ecosystem-platform/docs/features/firefox-sync/history-feature">History</a></li><li class="navListItem"><a class="navItem" href="/ecosystem-platform/docs/features/firefox-sync/account-management-feature">Account Management</a></li></ul></div></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Reference</h3><ul class=""><li class="navListItem"><a class="navItem" href="/ecosystem-platform/docs/reference/best-practices">Best Practices</a></li><li class="navListItem"><a class="navItem" href="/ecosystem-platform/docs/reference/glossary">Glossary</a></li><li class="navListItem"><a class="navItem" href="/ecosystem-platform/docs/reference/ecosystem-map">reference/ecosystem-map</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">For Relying Parties</h3><ul class=""><li class="navListItem"><a class="navItem" href="/ecosystem-platform/docs/relying-parties/end-to-end-encryption">End-to-end Encryption</a></li><li class="navListItem"><a class="navItem" href="/ecosystem-platform/docs/relying-parties/metrics-for-relying-parties">Metrics</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">For FxA Engineers</h3><ul class=""><li class="navListItem"><a class="navItem" href="/ecosystem-platform/docs/fxa-engineering/fxa-dev-process">Development Process</a></li><li class="navListItem"><a class="navItem" href="/ecosystem-platform/docs/fxa-engineering/release-process">Release Process</a></li><li class="navListItem"><a class="navItem" href="/ecosystem-platform/docs/fxa-engineering/fxa-api">Internal API Documentation</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/ecosystem-platform/docs/fxa-engineering/fxa-system-diagrams">FxA System Diagrams</a></li><li class="navListItem"><a class="navItem" href="/ecosystem-platform/docs/fxa-engineering/fxa-logging">Application Logging</a></li><li class="navListItem"><a class="navItem" href="/ecosystem-platform/docs/fxa-engineering/vscode-development">Using VS Code with FxA</a></li><li class="navListItem"><a class="navItem" href="/ecosystem-platform/docs/fxa-engineering/fxa-sub-platform">Subscription Platform</a></li><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Topic Deep Dives</h4><ul><li class="navListItem"><a class="navItem" href="/ecosystem-platform/docs/fxa-engineering/fxa-email">Processing Email</a></li><li class="navListItem"><a class="navItem" href="/ecosystem-platform/docs/fxa-engineering/fxa-metrics">Metrics</a></li><li class="navListItem"><a class="navItem" href="/ecosystem-platform/docs/fxa-engineering/fxa-localization">Localization</a></li><li class="navListItem"><a class="navItem" href="/ecosystem-platform/docs/fxa-engineering/fxa-jwt-access-tokens">JWT Access Tokens</a></li><li class="navListItem"><a class="navItem" href="/ecosystem-platform/docs/fxa-engineering/fxa-webchannel-protocol">WebChannels in Desktop &amp; Fennec</a></li><li class="navListItem"><a class="navItem" href="/ecosystem-platform/docs/fxa-engineering/fxa-oauth-webchannel-protocol">WebChannels in Fenix &amp; WebExtensions</a></li><li class="navListItem"><a class="navItem" href="/ecosystem-platform/docs/fxa-engineering/fxa-content-server-ab-testing">Experiments &amp; A/B testing</a></li><li class="navListItem"><a class="navItem" href="/ecosystem-platform/docs/fxa-engineering/fxa-tests-circleci">Tests in CircleCI</a></li><li class="navListItem"><a class="navItem" href="/ecosystem-platform/docs/fxa-engineering/functional-testing">Functional/Selenium Tests</a></li><li class="navListItem"><a class="navItem" href="/ecosystem-platform/docs/fxa-engineering/fxa-content-server-architecture">Content-server architecture</a></li></ul></div><li class="navListItem"><a class="navItem" href="/ecosystem-platform/docs/fxa-engineering/fxa-adr">Architectural Decision Records</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">About</h3><ul class=""><li class="navListItem"><a class="navItem" href="/ecosystem-platform/docs/about/the-teams">The Teams</a></li><li class="navListItem"><a class="navItem" href="/ecosystem-platform/docs/about/history">History</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 class="postHeaderTitle">Maps of the FxA Universe</h1></header><article><div><span><p>Current as of <code>November 15th, 2019</code></p>
<p>Click on any image to expand.</p>
<h2><a class="anchor" aria-hidden="true" id="fxa-universe"></a><a href="#fxa-universe" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>FxA universe</h2>
<pre><code class="hljs css language-mermaid"><span class="hljs-keyword">state</span>Diagram
  <span class="hljs-keyword">state</span> <span class="hljs-string">"RP"</span> as RP
  <span class="hljs-keyword">state</span> <span class="hljs-string">"Amazon S3"</span> as s3: Profile photo storage
  <span class="hljs-keyword">state</span> <span class="hljs-string">"Amazon SNS"</span> as sns: Amazon hosted email/SMS
  <span class="hljs-keyword">state</span> <span class="hljs-string">"Amplitude"</span> as amplitude: Hosted metrics
  <span class="hljs-keyword">state</span> <span class="hljs-string">"Basket - Salesforce Marketing Cloud (SFMC)"</span> as basket: Send marketing emails, hosted by Marketing
  <span class="hljs-keyword">state</span> <span class="hljs-string">"fraud detection pipeline"</span> as fdp: Should an event be blocked? Hosted by SecOps
  <span class="hljs-keyword">state</span> <span class="hljs-string">"fxa-auth-server"</span> as auth: authn/authz
  <span class="hljs-keyword">state</span> <span class="hljs-string">"fxa-auth-db-mysql"</span> as authdb: DB service <span class="hljs-keyword">for</span> auth-server
  <span class="hljs-keyword">state</span> <span class="hljs-string">"fxa-content-server"</span> as content
  <span class="hljs-keyword">state</span> <span class="hljs-string">"fxa-customs-server"</span> as customs: Fraud/abuse prevention
  <span class="hljs-keyword">state</span> <span class="hljs-string">"fxa-email-service"</span> as email: SMTP gateway
  <span class="hljs-keyword">state</span> <span class="hljs-string">"fxa-event-broker"</span> as eb: Notify RPs of important <span class="hljs-keyword">user</span> events
  <span class="hljs-keyword">state</span> <span class="hljs-string">"fxa-payments-server"</span> as payments
  <span class="hljs-keyword">state</span> <span class="hljs-string">"fxa-profile-server"</span> as <span class="hljs-keyword">profile</span>
  <span class="hljs-keyword">state</span> <span class="hljs-string">"fxa-support-panel"</span> as support_panel: Allow support agents <span class="hljs-keyword">to</span> access <span class="hljs-keyword">user</span> info
  <span class="hljs-keyword">state</span> <span class="hljs-string">"gcp"</span> as gcp: logging/metrics
  <span class="hljs-keyword">state</span> <span class="hljs-string">"iprepd"</span> as iprepd: Should an IP be blocked? Hosted by SecOps
  <span class="hljs-keyword">state</span> <span class="hljs-string">"memcached"</span> as memcached: store blocks, rate limits
  <span class="hljs-keyword">state</span> <span class="hljs-string">"Mozilla Data Platform (MDP)"</span> as mdp: Send marketing emails, hosted by Marketing
  <span class="hljs-keyword">state</span> <span class="hljs-string">"mysql"</span> as mysql: auth, oauth, <span class="hljs-keyword">profile</span> CRUD
  <span class="hljs-keyword">state</span> <span class="hljs-string">"redis"</span> as redis: session/<span class="hljs-keyword">profile</span> info cache
  <span class="hljs-keyword">state</span> <span class="hljs-string">"subhub"</span> as subhub: Hosted by IT
  <span class="hljs-keyword">state</span> <span class="hljs-string">"Support agent"</span> as support_agent: Fix <span class="hljs-keyword">user</span> problems
  <span class="hljs-keyword">state</span> <span class="hljs-string">"Zendesk"</span> as zendesk: Hosted support management

  User--&gt;RP
  RP--&gt;auth
  RP--&gt;content
  auth--&gt;authdb
  auth--&gt;basket
  auth--&gt;customs
  auth--&gt;eb
  auth--&gt;email
  auth--&gt;gcp
  auth--&gt;mysql
  auth--&gt;profile
  auth--&gt;redis
  auth--&gt;sns
  auth--&gt;subhub
  auth--&gt;zendesk
  authdb--&gt;mysql
  content--&gt;auth
  content--&gt;gcp
  content--&gt;payments
  content--&gt;profile
  customs--&gt;gcp
  customs--&gt;iprepd
  customs--&gt;memcached
  eb--&gt;RP
  email--&gt;sns
  fdp--&gt;customs
  gcp--&gt;fdp
  gcp--&gt;mdp
  gcp--&gt;amplitude
  payments--&gt;auth
  payments--&gt;profile
  payments--&gt;stripe
  payments--&gt;gcp
  payments--&gt;RP
  profile--&gt;auth
  profile--&gt;gcp
  profile--&gt;mysql
  profile--&gt;s3
  subhub--&gt;stripe
  support_agent--&gt;support_panel
  support_agent--&gt;zendesk
  support_panel--&gt;auth
  support_panel--&gt;profile
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="fxa-auth-server"></a><a href="#fxa-auth-server" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>fxa-auth-server</h2>
<pre><code class="hljs css language-mermaid">stateDiagram
  state <span class="hljs-string">"RP"</span> as RP
  state <span class="hljs-string">"amazon sns"</span> as sns: Amazon hosted email<span class="hljs-built_in">/SMS
</span>  state <span class="hljs-string">"Basket - Salesforce Marketing Cloud (SFMC)"</span> as basket: Send marketing emails, hosted by Marketing
  state <span class="hljs-string">"fxa-auth-db-mysql"</span> as authdb: DB<span class="hljs-built_in"> service </span><span class="hljs-keyword">for</span> auth-server
  state <span class="hljs-string">"fxa-auth-server"</span> as auth: authn/authz
  state <span class="hljs-string">"fxa-content-server"</span> as content
  state <span class="hljs-string">"fxa-customs-server"</span> as customs: Fraud/abuse prevention
  state <span class="hljs-string">"fxa-email-service"</span> as email: SMTP gateway
  state <span class="hljs-string">"fxa-event-broker"</span> as eb: Notify RPs of important<span class="hljs-built_in"> user </span>events
  state <span class="hljs-string">"fxa-payments-server"</span> as payments
  state <span class="hljs-string">"fxa-profile-server"</span> as<span class="hljs-built_in"> profile
</span>  state <span class="hljs-string">"fxa-support-panel"</span> as support_panel: Allow support agents <span class="hljs-keyword">to</span> access<span class="hljs-built_in"> user </span><span class="hljs-builtin-name">info</span>
  state <span class="hljs-string">"gcp"</span> as gcp: logging/metrics
  state <span class="hljs-string">"mysql"</span> as mysql: auth, oauth,<span class="hljs-built_in"> profile </span>CRUD
  state <span class="hljs-string">"redis"</span> as redis: session<span class="hljs-built_in">/profile </span><span class="hljs-builtin-name">info</span> cache
  state <span class="hljs-string">"subhub"</span> as subhub: Hosted by IT
  state <span class="hljs-string">"Zendesk"</span> as zendesk: Hosted support management

  RP--&gt;auth : 1
  content--&gt;auth : 2
  payments--&gt;auth : 3
  profile--&gt;auth : 4
  support_panel--&gt;auth : 5
  auth--&gt;authdb : 6
  auth--&gt;basket : 7
  auth--&gt;customs : 8
  auth--&gt;eb : 9
  auth--&gt;email : 10
  auth--&gt;gcp : 11
  auth--&gt;mysql : 12
  auth--&gt;redis : 13
  auth--&gt;sns : 14
  auth--&gt;subhub : 15
  auth--&gt;zendesk : 16

 <span class="hljs-built_in"> note </span>left of RP
<span class="hljs-literal">No</span>. <span class="hljs-built_in"> Connection </span>            Reason
1.   RP &amp;rarr; auth              verify/fetch OAuth tokens
2.   content &amp;rarr; auth         authentication/authorization
3.   payments &amp;rarr; auth        update subscriptions
4.  <span class="hljs-built_in"> profile </span>&amp;rarr; auth         canonical<span class="hljs-built_in"> profile </span><span class="hljs-builtin-name">info</span>
5.   support_panel &amp;rarr; auth   view<span class="hljs-built_in"> user </span><span class="hljs-builtin-name">info</span>
6.   auth &amp;rarr; authdb          authentication/subscription CRUD
7.   auth &amp;rarr; basket          notify of<span class="hljs-built_in"> user </span>events
8.   auth &amp;rarr; customs         fraud detection
9.   auth &amp;rarr; event broker    notify of<span class="hljs-built_in"> user </span>update
10.  auth &amp;rarr; email           send email <span class="hljs-keyword">to</span><span class="hljs-built_in"> users
</span>11.  auth &amp;rarr; gcp            <span class="hljs-built_in"> logging
</span>12.  auth &amp;rarr; mysql           authorization CRUD
13.  auth &amp;rarr; redis           profile/sessionToken cache
14.  auth &amp;rarr; sns             send<span class="hljs-built_in"> SMS </span>messages
15.  auth &amp;rarr; subhub          update subscriptions
16.  auth &amp;rarr; zendesk         file support tickets

  end<span class="hljs-built_in"> note
</span>
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="fxa-content-server"></a><a href="#fxa-content-server" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>fxa-content-server</h2>
<pre><code class="hljs css language-mermaid">stateDiagram
  RP
  state <span class="hljs-string">"fxa-auth-server"</span> as auth: authn/authz
  state <span class="hljs-string">"fxa-content-server"</span> as content
  state <span class="hljs-string">"fxa-payments-server"</span> as payments
  state <span class="hljs-string">"fxa-profile-server"</span> as<span class="hljs-built_in"> profile
</span>  state <span class="hljs-string">"gcp"</span> as gcp: logging/metrics

  RP--&gt;content : 1
  content--&gt;auth : 2
  content--&gt;payments : 3
  content--&gt;profile : 4
  content--&gt;gcp : 5

 <span class="hljs-built_in"> note </span>left of RP
<span class="hljs-literal">No</span>. <span class="hljs-built_in"> Connection </span>         Reason
1.   RP &amp;rarr; content        authorization
2.   content &amp;rarr; auth      authentication &amp;amp; authorization
3.   content &amp;rarr; payments  redirect <span class="hljs-keyword">to</span> update subscriptions
4.   content &amp;rarr;<span class="hljs-built_in"> profile </span>  fetch subscription <span class="hljs-builtin-name">info</span>
5.   content &amp;rarr; gcp       send logs

  end<span class="hljs-built_in"> note
</span></code></pre>
<h2><a class="anchor" aria-hidden="true" id="fxa-customs-server"></a><a href="#fxa-customs-server" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>fxa-customs-server</h2>
<pre><code class="hljs css language-mermaid">stateDiagram
  state <span class="hljs-string">"fxa-auth-server"</span> as auth: authn/authz
  state <span class="hljs-string">"fxa-customs-server"</span> as customs: Fraud/abuse prevention
  state <span class="hljs-string">"gcp"</span> as gcp: logging/metrics
  state <span class="hljs-string">"memcached"</span> as memcached: store blocks, rate limits
  state <span class="hljs-string">"iprepd"</span> as iprepd: Should an<span class="hljs-built_in"> IP </span>be blocked? Hosted by SecOps
  state <span class="hljs-string">"fraud detection pipeline"</span> as fdp: Should an event be blocked? Hosted by SecOps

  auth--&gt;customs : 1
  customs--&gt;gcp : 2
  customs--&gt;iprepd : 3
  customs--&gt;memcached : 4
  fdp--&gt;customs : 5
  gcp--&gt;fdp : 6

 <span class="hljs-built_in"> note </span>left of auth
<span class="hljs-literal">No</span>. <span class="hljs-built_in"> Connection </span>          Reason
1.   auth &amp;rarr; customs       check whether request should be blocked
2.   customs &amp;rarr; gcp        send logs
3.   customs &amp;rarr; iprepd     check<span class="hljs-built_in"> ip address
</span>4.   customs &amp;rarr; memcached  store counts &amp;amp; blocks
5.   fdp &amp;rarr; customs        inform of block
6.   gcp &amp;rarr; fdp            notify of<span class="hljs-built_in"> user </span>events
  end<span class="hljs-built_in"> note
</span>
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="fxa-email-service"></a><a href="#fxa-email-service" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>fxa-email-service</h2>
<pre><code class="hljs css language-mermaid"><span class="hljs-keyword">state</span>Diagram
  <span class="hljs-keyword">state</span> <span class="hljs-string">"fxa-auth-server"</span> as auth: authn/authz
  <span class="hljs-keyword">state</span> <span class="hljs-string">"fxa-email-service"</span> as email: SMTP gateway
  <span class="hljs-keyword">state</span> <span class="hljs-string">"amazon sns"</span> as sns: Amazon hosted email/SMS

  auth--&gt;email
  email--&gt;sns
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="fxa-payments-server"></a><a href="#fxa-payments-server" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>fxa-payments-server</h2>
<pre><code class="hljs css language-mermaid">stateDiagram
  state <span class="hljs-string">"fxa-auth-server"</span> as auth: authn/authz
  state <span class="hljs-string">"fxa-content-server"</span> as content
  state <span class="hljs-string">"fxa-payments-server"</span> as payments
  state <span class="hljs-string">"fxa-profile-server"</span> as<span class="hljs-built_in"> profile
</span>  state <span class="hljs-string">"gcp"</span> as gcp: logging/metrics

  content--&gt;payments : 1
  payments--&gt;auth : 2
  payments--&gt;profile : 3
  payments--&gt;stripe : 4
  payments--&gt;gcp : 5
  payments--&gt;RP : 6

 <span class="hljs-built_in"> note </span>left of content
<span class="hljs-literal">No</span>. <span class="hljs-built_in"> Connection </span>          Reason
1.   content &amp;rarr; payments   redirect
2.   payments &amp;rarr; auth      update subscriptions
3.   payments &amp;rarr;<span class="hljs-built_in"> profile </span>  <span class="hljs-builtin-name">get</span><span class="hljs-built_in"> user profile
</span>4.   payments &amp;rarr; stripe    <span class="hljs-builtin-name">get</span> payment widget
5.   payments &amp;rarr; gcp       send logs &amp;amp; metrics
6.   payments &amp;rarr; RP        redirect after subscription update

  end<span class="hljs-built_in"> note
</span></code></pre>
<h2><a class="anchor" aria-hidden="true" id="fxa-profile-server"></a><a href="#fxa-profile-server" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>fxa-profile-server</h2>
<pre><code class="hljs css language-mermaid">stateDiagram
  state <span class="hljs-string">"fxa-auth-server"</span> as auth: authn/authz
  state <span class="hljs-string">"fxa-content-server"</span> as content
  state <span class="hljs-string">"fxa-payments-server"</span> as payments
  state <span class="hljs-string">"fxa-profile-server"</span> as<span class="hljs-built_in"> profile
</span>  state <span class="hljs-string">"mysql"</span> as mysql: auth, oauth,<span class="hljs-built_in"> profile </span>CRUD
  state <span class="hljs-string">"gcp"</span> as gcp: logging/metrics
  state <span class="hljs-string">"fxa-support-panel"</span> as support_panel: Allow support agents <span class="hljs-keyword">to</span> access<span class="hljs-built_in"> user </span><span class="hljs-builtin-name">info</span>
  state <span class="hljs-string">"S3"</span> as s3:<span class="hljs-built_in"> Profile </span>photo storage

  content--&gt;profile : 1
  payments--&gt;profile : 2
  auth--&gt;profile : 3
  profile--&gt;auth : 4
  support_panel--&gt;profile : 5
  profile--&gt;gcp : 6
  profile--&gt;mysql : 7
  profile--&gt;s3 : 8

 <span class="hljs-built_in"> note </span>left of gcp
<span class="hljs-literal">No</span>. <span class="hljs-built_in"> Connection </span>              Reason
1.   content &amp;rarr;<span class="hljs-built_in"> profile </span>       <span class="hljs-builtin-name">get</span><span class="hljs-built_in"> user profile
</span>2.   payments &amp;rarr;<span class="hljs-built_in"> profile </span>      <span class="hljs-builtin-name">get</span><span class="hljs-built_in"> user profile
</span>3.   auth &amp;rarr;<span class="hljs-built_in"> profile </span>          notify of<span class="hljs-built_in"> user </span>events
4.  <span class="hljs-built_in"> profile </span>&amp;rarr; auth           <span class="hljs-builtin-name">get</span> canonical<span class="hljs-built_in"> profile </span><span class="hljs-builtin-name">info</span>
5.   support_panel &amp;rarr;<span class="hljs-built_in"> profile </span> <span class="hljs-builtin-name">get</span> <span class="hljs-built_in"> user profile
</span>6.  <span class="hljs-built_in"> profile </span>&amp;rarr; gcp            logging/metrics
7.  <span class="hljs-built_in"> profile </span>&amp;rarr; mysql         <span class="hljs-built_in"> profile </span>CRUD
8.  <span class="hljs-built_in"> profile </span>&amp;rarr; s3             store<span class="hljs-built_in"> profile </span>photos
  end<span class="hljs-built_in"> note
</span></code></pre>
<h2><a class="anchor" aria-hidden="true" id="fxa-support-panel"></a><a href="#fxa-support-panel" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>fxa-support-panel</h2>
<pre><code class="hljs css language-mermaid">stateDiagram
  state <span class="hljs-string">"fxa-auth-server"</span> as auth: authn/authz
  state <span class="hljs-string">"fxa-content-server"</span> as content
  state <span class="hljs-string">"fxa-profile-server"</span> as<span class="hljs-built_in"> profile
</span>  state <span class="hljs-string">"fxa-support-panel"</span> as support_panel: Allow support agents <span class="hljs-keyword">to</span> access<span class="hljs-built_in"> user </span><span class="hljs-builtin-name">info</span>
  state <span class="hljs-string">"Support agent"</span> as support_agent: Fix<span class="hljs-built_in"> user </span>problems
  state <span class="hljs-string">"Zendesk"</span> as zendesk: Hosted support management

  User--&gt;content : 1
  content--&gt;auth : 2
  auth--&gt;zendesk : 3
  support_agent--&gt;support_panel : 4
  support_agent--&gt;zendesk : 5
  support_panel--&gt;auth : 6
  support_panel--&gt;profile : 7

 <span class="hljs-built_in"> note </span>left of zendesk
<span class="hljs-literal">No</span>. <span class="hljs-built_in"> Connection </span>                     Reason
1.  <span class="hljs-built_in"> User </span>&amp;rarr; content                  file support ticket
2.   content &amp;rarr; auth                  forward support ticket
3.   auth &amp;rarr; zendesk                  forward support ticket
4.   support_agent &amp;rarr; support_panel   check<span class="hljs-built_in"> user </span>status
5.   support_agent &amp;rarr; zendesk         <span class="hljs-builtin-name">get</span> support ticket
6.   support_panel &amp;rarr; auth            <span class="hljs-builtin-name">get</span><span class="hljs-built_in"> user </span><span class="hljs-builtin-name">info</span>
7.   support_panel &amp;rarr;<span class="hljs-built_in"> profile </span>        <span class="hljs-builtin-name">get</span><span class="hljs-built_in"> user </span><span class="hljs-builtin-name">info</span>

  end<span class="hljs-built_in"> note
</span></code></pre>
<h1><a class="anchor" aria-hidden="true" id="a-few-additional-diagrams"></a><a href="#a-few-additional-diagrams" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>A few additional diagrams</h1>
<p>There are a few more private diagrams maintained by the operations group about
how we have our cloud services set up.  If you're an employee, you can see
them here:</p>
<ul>
<li><a href="https://mana.mozilla.org/wiki/display/SVCOPS/FxA+Auth+Server+Logical+Diagram">Firefox Accounts Auth Server Logical Diagram</a></li>
<li><a href="https://mana.mozilla.org/wiki/display/SVCOPS/FxA+Content+Server+Logical+Diagram">Firefox Accounts Content Server Logical Diagram</a></li>
<li><a href="https://mana.mozilla.org/wiki/display/SVCOPS/FxA+Profile+Server+Logical+Diagram">Firefox Accounts Profile Server Logical Diagram</a></li>
</ul>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/ecosystem-platform/docs/fxa-engineering/fxa-api"><span class="arrow-prev">← </span><span>Internal API Documentation</span></a><a class="docs-next button" href="/ecosystem-platform/docs/fxa-engineering/fxa-logging"><span>Application Logging</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#fxa-universe">FxA universe</a></li><li><a href="#fxa-auth-server">fxa-auth-server</a></li><li><a href="#fxa-content-server">fxa-content-server</a></li><li><a href="#fxa-customs-server">fxa-customs-server</a></li><li><a href="#fxa-email-service">fxa-email-service</a></li><li><a href="#fxa-payments-server">fxa-payments-server</a></li><li><a href="#fxa-profile-server">fxa-profile-server</a></li><li><a href="#fxa-support-panel">fxa-support-panel</a></li></ul></nav></div><footer><img src="/ecosystem-platform/img/mozilla-logo.png" height="24"/><script src="https://unpkg.com/mermaid@8.4.2/dist/mermaid.min.js" type="application/javascript"></script><script>
        mermaid.initialize({
            startOnReady: true,
            theme: 'forest',
            themeCSS: '.noteText { font-family: monospace; }'
          });
        // remarkable converts the mermaid diagrams to HTML and injects a bunch
        // of HTML tags the mermaid parser cannot handle. Remove the HTML and
        // run the parser on the original text.
        const mermaidDiagramEls = document.querySelectorAll('.language-mermaid');
        mermaidDiagramEls.forEach(function(diagramEl, index) {
          // strip out any HTML
          diagramEl.innerHTML = diagramEl.innerText;
          diagramEl.addEventListener('click', (evt) => {
            evt.currentTarget.classList.toggle('highlight');
            document.body.classList.toggle('highlight-service');
          }, false);
        });
        mermaid.init(undefined, mermaidDiagramEls);
        </script></footer></div></body></html>