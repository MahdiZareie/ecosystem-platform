<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Metrics · Firefox Ecosystem Platform</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="Last updated: `March 11th, 2020`"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Metrics · Firefox Ecosystem Platform"/><meta property="og:type" content="website"/><meta property="og:url" content="https://mozilla.github.io/ecosystem-platform/"/><meta property="og:description" content="Last updated: `March 11th, 2020`"/><meta name="twitter:card" content="summary"/><link rel="shortcut icon" href="/ecosystem-platform/img/fx-master-brand.png"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script src="/ecosystem-platform/js/scrollSpy.js"></script><link rel="stylesheet" href="/ecosystem-platform/css/main.css"/><script src="/ecosystem-platform/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/ecosystem-platform/"><img class="logo" src="/ecosystem-platform/img/fx-master-brand.png" alt="Firefox Ecosystem Platform"/><h2 class="headerTitleWithLogo">Firefox Ecosystem Platform</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/ecosystem-platform/docs/welcome" target="_self">Docs</a></li><li class=""><a href="https://github.com/mozilla/ecosystem-platform" target="_self">GitHub</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Topic Deep Dives</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Introduction</h3><ul class=""><li class="navListItem"><a class="navItem" href="/ecosystem-platform/docs/welcome">Welcome</a></li><li class="navListItem"><a class="navItem" href="/ecosystem-platform/docs/platform-overview">Platform Overview</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">The Process</h3><ul class=""><li class="navListItem"><a class="navItem" href="/ecosystem-platform/docs/process/integration-with-fxa">Integration with FxA</a></li><li class="navListItem"><a class="navItem" href="/ecosystem-platform/docs/process/integration-with-subscription-platform">Integration with Subscription Platform</a></li><li class="navListItem"><a class="navItem" href="/ecosystem-platform/docs/process/becoming-a-sync-client">Becoming A Sync Client</a></li><li class="navListItem"><a class="navItem" href="/ecosystem-platform/docs/process/sync-testing">Sync Testing</a></li><li class="navListItem"><a class="navItem" href="/ecosystem-platform/docs/process/using-the-staging-environment">Using the Staging Environment</a></li><li class="navListItem"><a class="navItem" href="/ecosystem-platform/docs/process/interruptive-surveys">Running Surveys in FxA</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Platform Features</h3><ul class=""><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Subscription Platform</h4><ul><li class="navListItem"><a class="navItem" href="/ecosystem-platform/docs/features/sub-plat/sub-plat-features">Subscription Features</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Firefox Sync</h4><ul><li class="navListItem"><a class="navItem" href="/ecosystem-platform/docs/features/firefox-sync/sync-feature">Overview</a></li><li class="navListItem"><a class="navItem" href="/ecosystem-platform/docs/features/firefox-sync/password-management-feature">Password Management and Syncing</a></li><li class="navListItem"><a class="navItem" href="/ecosystem-platform/docs/features/firefox-sync/bookmarks-feature">Bookmarks</a></li><li class="navListItem"><a class="navItem" href="/ecosystem-platform/docs/features/firefox-sync/storage-feature">Storage</a></li><li class="navListItem"><a class="navItem" href="/ecosystem-platform/docs/features/firefox-sync/history-feature">History</a></li><li class="navListItem"><a class="navItem" href="/ecosystem-platform/docs/features/firefox-sync/account-management-feature">Account Management</a></li></ul></div></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Reference</h3><ul class=""><li class="navListItem"><a class="navItem" href="/ecosystem-platform/docs/reference/best-practices">Best Practices</a></li><li class="navListItem"><a class="navItem" href="/ecosystem-platform/docs/reference/glossary">Glossary</a></li><li class="navListItem"><a class="navItem" href="/ecosystem-platform/docs/reference/ecosystem-map">reference/ecosystem-map</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">For Relying Parties</h3><ul class=""><li class="navListItem"><a class="navItem" href="/ecosystem-platform/docs/relying-parties/end-to-end-encryption">End-to-end Encryption</a></li><li class="navListItem"><a class="navItem" href="/ecosystem-platform/docs/relying-parties/metrics-for-relying-parties">Metrics</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">For FxA Engineers</h3><ul class=""><li class="navListItem"><a class="navItem" href="/ecosystem-platform/docs/fxa-engineering/fxa-dev-process">Development Process</a></li><li class="navListItem"><a class="navItem" href="/ecosystem-platform/docs/fxa-engineering/release-process">Release Process</a></li><li class="navListItem"><a class="navItem" href="/ecosystem-platform/docs/fxa-engineering/fxa-api">Internal API Documentation</a></li><li class="navListItem"><a class="navItem" href="/ecosystem-platform/docs/fxa-engineering/fxa-system-diagrams">FxA System Diagrams</a></li><li class="navListItem"><a class="navItem" href="/ecosystem-platform/docs/fxa-engineering/fxa-logging">Application Logging</a></li><li class="navListItem"><a class="navItem" href="/ecosystem-platform/docs/fxa-engineering/vscode-development">Using VS Code with FxA</a></li><li class="navListItem"><a class="navItem" href="/ecosystem-platform/docs/fxa-engineering/fxa-sub-platform">Subscription Platform</a></li><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Topic Deep Dives</h4><ul><li class="navListItem"><a class="navItem" href="/ecosystem-platform/docs/fxa-engineering/fxa-email">Processing Email</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/ecosystem-platform/docs/fxa-engineering/fxa-metrics">Metrics</a></li><li class="navListItem"><a class="navItem" href="/ecosystem-platform/docs/fxa-engineering/fxa-localization">Localization</a></li><li class="navListItem"><a class="navItem" href="/ecosystem-platform/docs/fxa-engineering/fxa-jwt-access-tokens">JWT Access Tokens</a></li><li class="navListItem"><a class="navItem" href="/ecosystem-platform/docs/fxa-engineering/fxa-webchannel-protocol">WebChannels in Desktop &amp; Fennec</a></li><li class="navListItem"><a class="navItem" href="/ecosystem-platform/docs/fxa-engineering/fxa-oauth-webchannel-protocol">WebChannels in Fenix &amp; WebExtensions</a></li><li class="navListItem"><a class="navItem" href="/ecosystem-platform/docs/fxa-engineering/fxa-content-server-ab-testing">Experiments &amp; A/B testing</a></li><li class="navListItem"><a class="navItem" href="/ecosystem-platform/docs/fxa-engineering/fxa-tests-circleci">Tests in CircleCI</a></li><li class="navListItem"><a class="navItem" href="/ecosystem-platform/docs/fxa-engineering/functional-testing">Functional/Selenium Tests</a></li><li class="navListItem"><a class="navItem" href="/ecosystem-platform/docs/fxa-engineering/fxa-content-server-architecture">Content-server architecture</a></li></ul></div><li class="navListItem"><a class="navItem" href="/ecosystem-platform/docs/fxa-engineering/fxa-adr">Architectural Decision Records</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 class="postHeaderTitle">Metrics</h1></header><article><div><span><p>Last updated: <code>March 11th, 2020</code></p>
<h1><a class="anchor" aria-hidden="true" id="what-types-of-metrics-are-there"></a><a href="#what-types-of-metrics-are-there" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>What types of metrics are there?</h1>
<p>The FxA metrics ecosystem is somewhat arcane and esoteric, so a brief history of how we got to where we are may be helpful to understand the landscape.</p>
<p>In the beginning there were activity events. These were basic events emitted from the auth and oauth (and profile?) servers, visualised via the now-defunct accounts dashboard:</p>
<ul>
<li><a href="https://metrics.services.mozilla.com/accounts-dashboard/">https://metrics.services.mozilla.com/accounts-dashboard/</a></li>
<li><a href="https://github.com/mozilla/accounts-dashboard">https://github.com/mozilla/accounts-dashboard</a></li>
</ul>
<p>They provided useful insights from a high level about things like how many sign-ins and sign-ups there were. But they didn’t allow us to follow a user’s journey through a sign-in or sign-up flow, which include email verification steps that may take place across multiple devices.</p>
<p>So the flow events were created, stored in Redshift and visualised in Redash (and the existing activity metrics were moved to Redshift/Redash at the same time):</p>
<ul>
<li><a href="https://sql.telemetry.mozilla.org/">https://sql.telemetry.mozilla.org/</a></li>
<li><a href="https://github.com/mozilla/fxa-activity-metrics/">https://github.com/mozilla/fxa-activity-metrics/</a></li>
</ul>
<p>Flow events include two extra pieces of metadata, a flow id and a flow begin-time, which gave us more detailed insight into user behaviour. And, unlike the activity events, these were also emitted by client-side code in the content server.</p>
<p>The flow events proved handy for some use-cases that they weren’t meant for, so we started piggy-backing other things like performance metrics, post-sign-in activity and email events on them too. That stressed the infrastructure somewhat, but also gave us the ability to e.g. directly link perf metrics to user behaviour, which was an unexpected new superpower.</p>
<p>The stressed infrastructure meant queries ran pretty slowly though and they required SQL knowledge. And the organic growth of the event schema meant there were issues around inconsistent nomenclature confusing people. And they were ingested via Heka, which meant working with an unfamiliar language (Lua) in an environment that was hard to meaningfully test without just pushing your changes and seeing whether they worked. And we never got round to ingesting the events more frequently than daily, so people were frustrated about having to wait a day to see stuff show up in charts.</p>
<p>For all of those reasons, Amplitude was chosen as a paid-for replacement for the more producty metrics we were sending to Redshift:</p>
<ul>
<li><a href="https://analytics.amplitude.com/org/31251">https://analytics.amplitude.com/org/31251</a></li>
<li><a href="https://github.com/mozilla/fxa-amplitude-send">https://github.com/mozilla/fxa-amplitude-send</a></li>
</ul>
<p>The event schema was designed in advance, so it would be less confusing to understand and we sent them to Amplitude in real time from the very beginning, so there was no inertia around making them show up instantly in the UI. And nobody needed to wrestle with SQL any more.</p>
<p>But the limited event schema we have in Amplitude means there are some things we can’t see there, so the stuff in Redshift+Redash remains a useful resource, especially for devs.</p>
<p>In Fall of 2019, FxA started sending <a href="https://codeascraft.com/2011/02/15/measure-anything-measure-everything/">StatsD</a> metrics to Mozilla's <a href="https://mana.mozilla.org/wiki/pages/viewpage.action?spaceKey=SVCOPS&amp;title=InfluxDB">InfluxDB</a> stack.  These are performance metrics.  They powered our dashboards in <a href="https://earthangel-b40313e5.influxcloud.net/dashboards/f/Q6zOs-JZk/firefox-accounts-fxa">Grafana</a>.  At the time of writing, the FxA packages that use StatsD include:</p>
<ul>
<li>fxa-auth-server</li>
<li>fxa-event-broker</li>
<li>fxa-payments-server</li>
</ul>
<h1><a class="anchor" aria-hidden="true" id="how-are-metrics-emitted"></a><a href="#how-are-metrics-emitted" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>How are metrics emitted?</h1>
<h2><a class="anchor" aria-hidden="true" id="auth-server"></a><a href="#auth-server" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Auth server</h2>
<p>Activity events, flow events and amplitude events are all just mozlog-format log lines. There are functions for each of them in the module <code>lib/log.js</code>, respectively called <code>activityEvent</code>, <code>flowEvent</code> and <code>amplitudeEvent</code>. However, to reduce boilerplate in the codebase they’re actually invoked via calls to <code>request.emitMetricsEvent</code>. That function is defined in <code>lib/metrics/events.js</code> and is decorated onto the request object by some code in <code>lib/server.js</code>.</p>
<p>Activity events must have a <code>uid</code> property. Some call sites also set <code>device_id</code>. Properties containing user agent information and the OAuth client id are set automatically based on the request object.</p>
<p>Flow events have their properties set automatically too, either from the request object or, if there is an authentication token of some kind, from data stored against the uid and token id in memcached. This data is widely referred to as <code>metricsContext</code> throughout the codebase and has a lifetime of 2 hours, which is kind of an arbitrary limit that allows us to fetch data for most flows while ignoring dubious data from stale or non-authentic sources. The <code>metricsContext</code> is written to memcached via calls to <code>request.stashMetricsContext</code> (where it’s copied from the request data) and <code>request.propagateMetricsContext</code> (where it’s copied from some other stashed data). Those functions are both defined in <code>lib/metrics/context.js</code> and decorated onto the request object in <code>lib/server.js</code>.</p>
<p>Amplitude events are not explicitly emitted, because they can all be mapped to from previously-existing activity or flow events. Those mappings are defined by structures called <code>EVENTS</code> and <code>FUZZY_EVENTS</code> in <code>lib/metrics/amplitude.js</code>. Any event matching a string key from <code>EVENTS</code> or a regex key from <code>FUZZY_EVENTS</code> gets transformed into the corresponding event by common code in the <code>fxa-shared</code> package (it’s also used by the content server). Most of the properties on those events are set automatically, although there are still some cases where data must be set explicitly at the call site.</p>
<p>StatsD is used to capture latency performance metrics on SQS calls, SNS calls, Stripe calls, and any HTTP API requests handled by <code>lib/backendService.js</code> (e.g. requests to our customs server).  It is also used to time the server's request handling on all routes.</p>
<h2><a class="anchor" aria-hidden="true" id="content-server"></a><a href="#content-server" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Content server</h2>
<p>Again, flow events and amplitude events in the content server are just mozlog-format log lines. But before they can be logged on the back-end, the front-end has to submit them to the endpoint POST <code>/metrics</code> first. This is handled by the module <code>app/scripts/lib/metrics.js</code>.</p>
<p>The front-end also needs to make sure it has a <code>flowId</code> and <code>flowBeginTime</code>, either from <code>data- attributes</code> on the body element that were set by the back-end, or from data propagated in the resume token. In both cases, the data is loaded by <code>app/scripts/models/flow.js</code>.</p>
<p>After they reach the back-end, events are processed by <code>server/lib/flow-event.js</code>. And, just like the auth server, there are <code>EVENTS</code> and <code>FUZZY_EVENTS</code> mappings to control transformations to amplitude events in <code>server/lib/amplitude.js</code>.</p>
<h2><a class="anchor" aria-hidden="true" id="event-broker"></a><a href="#event-broker" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Event Broker</h2>
<p>StatsD is used to collect SQS processing latency metrics and message type counts.  Details are on <a href="https://github.com/mozilla/fxa/tree/master/packages/fxa-event-broker#metrics">the package's README</a>.</p>
<h2><a class="anchor" aria-hidden="true" id="payments-server"></a><a href="#payments-server" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Payments server</h2>
<p>One thing to keep in mind is that users should not access the pages on Payments directly.  The Content server will redirect them to the Payments server, along with metrics related query params.  Those query params are:</p>
<ul>
<li><code>flow_id</code></li>
<li><code>flow_begin_time</code></li>
<li><code>device_id</code></li>
</ul>
<p>They are converted to <code>camelCase</code> once in Payments.</p>
<p>The main module on the front end for emitting events is <code>src/lib/flow-events.ts</code>.  Its <code>init</code> function is called in <code>src/App.tsx</code>, during which the three query params above are passed into the module.</p>
<p><em>All</em> Amplitude events are emitted from <code>src/store/amplitude-middleware.ts</code>.  They are triggered by <a href="https://redux.js.org/basics/actions">Redux actions</a>.</p>
<p>A call to <code>logAmplitudeEvent</code> results in a <code>POST</code> to <code>/metrics</code>, which is handled by <code>server/lib/routes/post-metrics.js</code>.  The events are log lines in identitical formats to those emitted by Content server.</p>
<p>The Payments frontend reports the timing data surfaced by <a href="https://www.w3.org/TR/navigation-timing-2/">Navigation Timing Level 2</a> back to the server side, which then sends the calculated performance metrics to our statsD server.  One major difference between these performance metrics and those in Redshift for Content Server is that these do not have a flow id to connect the timings into a performance overview for a particular request.</p>
<h1><a class="anchor" aria-hidden="true" id="how-are-metrics-ingested"></a><a href="#how-are-metrics-ingested" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>How are metrics ingested?</h1>
<h2><a class="anchor" aria-hidden="true" id="redshift"></a><a href="#redshift" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Redshift</h2>
<p>Activity and flow events are one of the last remaining datasets that is still being processed by our old Heka-based data pipeline. The data pipeline team are keen to migrate us away from there asap, but so far it didn’t happen yet. It would also benefit us to migrate away, since fear of breaking the Heka filter has discouraged us from making changes to the flow event schema in the past.</p>
<p>The Heka filter does some processing on the events and then writes them once-per-day to CSV files stored in S3 buckets:</p>
<ul>
<li><a href="s3://net-mozaws-prod-us-west-2-pipeline-analysis/fxa-retention/data/events/*">s3://net-mozaws-prod-us-west-2-pipeline-analysis/fxa-retention/data/events/*</a> (activity events)</li>
<li><a href="s3://net-mozaws-prod-us-west-2-pipeline-analysis/fxa-flow/data/*">s3://net-mozaws-prod-us-west-2-pipeline-analysis/fxa-flow/data/*</a> (flow events)</li>
<li><a href="s3://net-mozaws-prod-us-west-2-pipeline-analysis/fxa-email/data/email-events/*">s3://net-mozaws-prod-us-west-2-pipeline-analysis/fxa-email/data/email-events/*</a> (email events, which can be thought of as a variation of the flow events emitted by email-handling code in the auth server)</li>
</ul>
<p>The CSV files are then processed by python scripts in the <code>mozilla/fxa-activity-metrics</code> repo, running on the fxa-admin EC2 instance (managed by jrgm and jbuck):</p>
<ul>
<li><a href="https://github.com/mozilla/fxa-activity-metrics/">https://github.com/mozilla/fxa-activity-metrics/</a></li>
<li><a href="https://github.com/mozilla-services/cloudops-deployment/blob/master/projects/fxa/puppet/modules/fxa_admin/manifests/init.pp">https://github.com/mozilla-services/cloudops-deployment/blob/master/projects/fxa/puppet/modules/fxa_admin/manifests/init.pp</a></li>
</ul>
<p>The scripts import the data to a Redshift cluster managed by Ops, then expire old data.</p>
<p>For activity events, the table names are:</p>
<ul>
<li>activity_events</li>
<li>daily_activity_per_device</li>
<li>daily_multi_device_users</li>
</ul>
<p>For flow events, the table names are:</p>
<ul>
<li>flow_events</li>
<li>flow_metadata</li>
</ul>
<p>For email events, the table names are:</p>
<ul>
<li>email_events</li>
</ul>
<p>All of the tables named above contain a rolling 3-month window of data, to keep query times reasonable. We also maintain sampled datasets that have longer windows. Those are suffixed with <code>*_sampled_50</code> for the 50%-sampled dataset, which has a 6-month rolling window, and <code>*_sampled_10</code> for the 10%-dataset, which has a 2-year rolling window.</p>
<p>The tables are visible in Redash, under the “FxA Activity Metrics” data source.</p>
<h2><a class="anchor" aria-hidden="true" id="amplitude"></a><a href="#amplitude" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Amplitude</h2>
<p>Our Amplitude events are sent to a GCP pubsub queue from stackdriver, this stuff is managed by jbuck. We have a node script that listens to the queue and then sends the events to Amplitude:</p>
<ul>
<li><a href="https://github.com/mozilla/fxa-amplitude-send/blob/master/pubsub/index.js">https://github.com/mozilla/fxa-amplitude-send/blob/master/pubsub/index.js</a></li>
</ul>
<p>We manage to avoid any of the complicated batching logic recommended by some of the Amplitude documentation because our device ids for Amplitude are not persistent, they’re randomly-generated on every page load. So we don’t fall foul of the rate limits, except occasionally if there is some automated testing that thrashes a load of events in quick succession. There are issues open in the fxa repo about the device id thing, it was supposed to be a temporary measure but it’s been like that for years now so…</p>
<p>We do split some of the Amplitude metrics out to the <a href="https://help.amplitude.com/hc/en-us/articles/205406617-Identify-API-Modify-User-Properties">Identify API</a> so we can use its $append syntax. But most stuff just goes in to the plain <a href="https://help.amplitude.com/hc/en-us/articles/204771828-HTTP-API">HTTP API</a>.</p>
<h2><a class="anchor" aria-hidden="true" id="influxdb"></a><a href="#influxdb" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>InfluxDB</h2>
<p>The statsD metrics are sent to Telegraf, which then batch writes to InfluxDB.  The FxA team does not manage any part of the InfluxDB stack.</p>
<h1><a class="anchor" aria-hidden="true" id="how-do-i"></a><a href="#how-do-i" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>How do I...</h1>
<h2><a class="anchor" aria-hidden="true" id="create-a-new-activity-event"></a><a href="#create-a-new-activity-event" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>...create a new activity event?</h2>
<ol>
<li>Add the event name to <code>ACTIVITY_EVENTS</code> in <code>lib/metrics/events.js</code>. Unless it’s also a flow event (most new events will be one or the other), you should also add it to <code>NOT_FLOW_EVENTS</code> in the same module.</li>
<li>Emit the new event in code like <code>request.emitMetricsEvent('foo.bar', { uid })</code>.</li>
<li>Wherever you emit it, add test cases to cover that the event is correctly logged.</li>
</ol>
<h2><a class="anchor" aria-hidden="true" id="create-a-new-flow-event"></a><a href="#create-a-new-flow-event" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>...create a new flow event?</h2>
<h3><a class="anchor" aria-hidden="true" id="auth-server-1"></a><a href="#auth-server-1" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Auth server</h3>
<ol>
<li>Emit the new event in code like <code>request.emitMetricsEvent('foo.bar')</code>.</li>
<li>Wherever you emit it, add test cases to cover that the event is correctly logged.</li>
<li>Be aware that flow events are only emitted if you have a <code>metricsContext</code>. If there’s one in the payload for the current route, you’re all good. If not, the code will try to read one from memcached for you. But a previous call to <code>request.stashMetricsContext</code> or <code>request.propagateMetricsContext</code> will need to have been made with the token that your request is authenticated by. Maybe that’s done already, maybe it isn’t, you’ll need to trace the request flow and grep the code.</li>
</ol>
<h3><a class="anchor" aria-hidden="true" id="content-server-1"></a><a href="#content-server-1" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Content server</h3>
<ol>
<li>On the front-end, make sure your view has mixed in <code>FlowEventsMixin</code>.</li>
<li>view and engage events will be emitted automatically when you add the mixin, for other events you need to call <code>this.logFlowEvent</code> from your view.</li>
<li>Add test coverage for the new event to your view unit tests.</li>
</ol>
<h2><a class="anchor" aria-hidden="true" id="create-a-new-email-event"></a><a href="#create-a-new-email-event" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>...create a new email event?</h2>
<p>You don’t need to do this, it’s all set up to work automatically.</p>
<h2><a class="anchor" aria-hidden="true" id="create-a-new-amplitude-event"></a><a href="#create-a-new-amplitude-event" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>...create a new Amplitude event?</h2>
<ol>
<li>The first step is to make sure it’s been approved by Alex or Leif, because the Amplitude schema is tightly controlled and we pay per event.</li>
</ol>
<h3><a class="anchor" aria-hidden="true" id="auth-server-2"></a><a href="#auth-server-2" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Auth server</h3>
<ol>
<li>Amplitude events are all triggered by activity or flow events, so the first step is to ensure there’s one of those (see above if you need to create a new one).</li>
<li>If you’re triggering from a specific event, add a new mapping to the <code>EVENTS</code> object in <code>lib/metrics/amplitude.js</code>. If you’re triggering from a set of events, add a mapping to <code>FUZZY_EVENTS</code> instead.</li>
<li>Add a new test case for the new event to <code>test/local/metrics/amplitude.js</code>. Every event should have its own test case in that module.</li>
</ol>
<h3><a class="anchor" aria-hidden="true" id="content-server-2"></a><a href="#content-server-2" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Content server</h3>
<ol>
<li>Amplitude events are all triggered by flow or screen events, so the first step is to ensure there’s one of those (see above if you need to create a new flow event).</li>
<li>If you’re triggering from a specific event, add a new mapping to the <code>EVENTS</code> object in <code>server/lib/amplitude.js</code>. If you’re triggering from a set of events, add a mapping to <code>FUZZY_EVENTS</code> instead.</li>
<li>Add a new test case for the new event to <code>tests/server/amplitude.js</code>. Every event should have its own test case in that module.</li>
</ol>
<h1><a class="anchor" aria-hidden="true" id="what-other-docs-are-there"></a><a href="#what-other-docs-are-there" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>What other docs are there?</h1>
<ul>
<li><a href="https://github.com/mozilla/fxa/blob/master/packages/fxa-auth-server/docs/metrics-events.md">https://github.com/mozilla/fxa/blob/master/packages/fxa-auth-server/docs/metrics-events.md</a></li>
<li><a href="https://github.com/mozilla/fxa/blob/master/packages/fxa-content-server/docs/client-metrics.md">https://github.com/mozilla/fxa/blob/master/packages/fxa-content-server/docs/client-metrics.md</a></li>
<li><a href="https://github.com/mozilla/application-services/blob/master/docs/product-portal/accounts/metrics.md">https://github.com/mozilla/application-services/blob/master/docs/product-portal/accounts/metrics.md</a></li>
</ul>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/ecosystem-platform/docs/fxa-engineering/fxa-email"><span class="arrow-prev">← </span><span>Processing Email</span></a><a class="docs-next button" href="/ecosystem-platform/docs/fxa-engineering/fxa-localization"><span>Localization</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#auth-server">Auth server</a></li><li><a href="#content-server">Content server</a></li><li><a href="#event-broker">Event Broker</a></li><li><a href="#payments-server">Payments server</a></li><li><a href="#redshift">Redshift</a></li><li><a href="#amplitude">Amplitude</a></li><li><a href="#influxdb">InfluxDB</a></li><li><a href="#create-a-new-activity-event">...create a new activity event?</a></li><li><a href="#create-a-new-flow-event">...create a new flow event?</a><ul class="toc-headings"><li><a href="#auth-server-1">Auth server</a></li><li><a href="#content-server-1">Content server</a></li></ul></li><li><a href="#create-a-new-email-event">...create a new email event?</a></li><li><a href="#create-a-new-amplitude-event">...create a new Amplitude event?</a><ul class="toc-headings"><li><a href="#auth-server-2">Auth server</a></li><li><a href="#content-server-2">Content server</a></li></ul></li></ul></nav></div><footer><img src="/ecosystem-platform/img/mozilla-logo.png" height="24"/><script src="https://unpkg.com/mermaid@8.4.2/dist/mermaid.min.js" type="application/javascript"></script><script>
        mermaid.initialize({
            startOnReady: true,
            theme: 'forest',
            themeCSS: '.noteText { font-family: monospace; }'
          });
        // remarkable converts the mermaid diagrams to HTML and injects a bunch
        // of HTML tags the mermaid parser cannot handle. Remove the HTML and
        // run the parser on the original text.
        const mermaidDiagramEls = document.querySelectorAll('.language-mermaid');
        mermaidDiagramEls.forEach(function(diagramEl, index) {
          // strip out any HTML
          diagramEl.innerHTML = diagramEl.innerText;
          diagramEl.addEventListener('click', (evt) => {
            evt.currentTarget.classList.toggle('highlight');
            document.body.classList.toggle('highlight-service');
          }, false);
        });
        mermaid.init(undefined, mermaidDiagramEls);
        </script></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: 'bf6d9655ef3d5789d97465aff250ee76',
                indexName: 'mozilla_ecosystem-platform',
                inputSelector: '#search_input_react'
              });
            </script></body></html>