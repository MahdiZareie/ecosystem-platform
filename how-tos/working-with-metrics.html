<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.14">
<link rel="search" type="application/opensearchdescription+xml" title="Firefox Ecosystem Platform" href="/ecosystem-platform/opensearch.xml"><title data-react-helmet="true">Working with Metrics | Firefox Ecosystem Platform</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://mozilla.github.io/ecosystem-platform/how-tos/working-with-metrics"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Working with Metrics | Firefox Ecosystem Platform"><meta data-react-helmet="true" name="description" content="Last updated: March 21st, 2022"><meta data-react-helmet="true" property="og:description" content="Last updated: March 21st, 2022"><link data-react-helmet="true" rel="icon" href="/ecosystem-platform/img/firefox-logo.png"><link data-react-helmet="true" rel="canonical" href="https://mozilla.github.io/ecosystem-platform/how-tos/working-with-metrics"><link data-react-helmet="true" rel="alternate" href="https://mozilla.github.io/ecosystem-platform/how-tos/working-with-metrics" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://mozilla.github.io/ecosystem-platform/how-tos/working-with-metrics" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://RFM5H13DFK-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/ecosystem-platform/assets/css/styles.9f158ee2.css">
<link rel="preload" href="/ecosystem-platform/assets/js/runtime~main.8d6ee17d.js" as="script">
<link rel="preload" href="/ecosystem-platform/assets/js/main.feeacb3a.js" as="script">
</head>
<body>
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/ecosystem-platform/"><div class="navbar__logo"><img src="/ecosystem-platform/img/firefox-logo.png" alt="Ecosystem Platform Logo" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/ecosystem-platform/img/firefox-logo.png" alt="Ecosystem Platform Logo" class="themedImage_TMUO themedImage--dark_uzRr"></div><b class="navbar__title">Firefox Ecosystem Platform</b></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/mozilla/ecosystem-platform" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="searchBox_Utm0"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_i9tI" type="button"></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0"><nav class="menu thin-scrollbar menu_cyFh"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/ecosystem-platform/">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menuLinkText_OKON">For Relying Parties</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" tabindex="0" href="/ecosystem-platform/relying-parties/tutorials/integration-with-fxa">Tutorials</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" tabindex="0" href="/ecosystem-platform/relying-parties/how-twos/end-to-end-encryption">How-to Guides</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" tabindex="0" href="/ecosystem-platform/relying-parties/reference/metrics-for-relying-parties">Reference</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--active menuLinkText_OKON">For FxA Engineers</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" tabindex="0" href="/ecosystem-platform/tutorials/development-setup">Tutorials</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_TwRn" tabindex="0" href="/ecosystem-platform/how-tos/creating-an-account-locally">How-to Guides</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/how-tos/creating-an-account-locally">Creating an Account Locally</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/how-tos/local-emails-with-maildev">Local Emails with MailDev</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/how-tos/node-debugging">Node Debugging</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/how-tos/using-vscode-with-fxa">Using VS Code with FxA</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/how-tos/managing-yarn-dependencies">Managing Yarn Dependencies</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/how-tos/connecting-to-a-local-mysql-db">Connecting to a local MySQL DB</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/how-tos/using-a-custom-profile-with-firefox">Using a Custom Profile with Firefox</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/ecosystem-platform/how-tos/working-with-metrics">Working with Metrics</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" tabindex="0" href="/ecosystem-platform/reference/team-processes/development-process">Reference</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" tabindex="0" href="/ecosystem-platform/explanation/metrics">Explanation</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/additional-docs">Additional Docs</a></li></ul></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_eoK2"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_e+kA"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Working with Metrics</h1></header><p>Last updated: <code>March 21st, 2022</code></p><p>Other relevant documents include our <a href="/ecosystem-platform/reference/metrics">metrics reference</a> and <a href="/ecosystem-platform/explanation/metrics">metrics explanation</a>.</p><header><h1>How do I...</h1></header><h2 class="anchor anchorWithStickyNavbar_y2LR" id="create-a-new-activity-event">...create a new activity event?<a class="hash-link" href="#create-a-new-activity-event" title="Direct link to heading">​</a></h2><ol start="0"><li>Add the event name to <code>ACTIVITY_EVENTS</code> in <code>lib/metrics/events.js</code>. Unless it’s also a flow event (most new events will be one or the other), you should also add it to <code>NOT_FLOW_EVENTS</code> in the same module.</li><li>Emit the new event in code like <code>request.emitMetricsEvent(&#x27;foo.bar&#x27;, { uid })</code>.</li><li>Wherever you emit it, add test cases to cover that the event is correctly logged.</li></ol><h2 class="anchor anchorWithStickyNavbar_y2LR" id="create-a-new-flow-event">...create a new flow event?<a class="hash-link" href="#create-a-new-flow-event" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_y2LR" id="auth-server">Auth server<a class="hash-link" href="#auth-server" title="Direct link to heading">​</a></h3><ol start="0"><li>Emit the new event in code like <code>request.emitMetricsEvent(&#x27;foo.bar&#x27;)</code>.</li><li>Wherever you emit it, add test cases to cover that the event is correctly logged.</li><li>Be aware that flow events are only emitted if you have a <code>metricsContext</code>. If there’s one in the payload for the current route, you’re all good. If not, the code will try to read one from memcached for you. But a previous call to <code>request.stashMetricsContext</code> or <code>request.propagateMetricsContext</code> will need to have been made with the token that your request is authenticated by. Maybe that’s done already, maybe it isn’t, you’ll need to trace the request flow and grep the code.</li></ol><h3 class="anchor anchorWithStickyNavbar_y2LR" id="content-server">Content server<a class="hash-link" href="#content-server" title="Direct link to heading">​</a></h3><ol start="0"><li>On the front-end, make sure your view has mixed in <code>FlowEventsMixin</code>.</li><li>view and engage events will be emitted automatically when you add the mixin, for other events you need to call <code>this.logFlowEvent</code> from your view.</li><li>Add test coverage for the new event to your view unit tests.</li></ol><h2 class="anchor anchorWithStickyNavbar_y2LR" id="create-a-new-email-event">...create a new email event?<a class="hash-link" href="#create-a-new-email-event" title="Direct link to heading">​</a></h2><p>You don’t need to do this, it’s all set up to work automatically.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="create-a-new-amplitude-event">...create a new Amplitude event?<a class="hash-link" href="#create-a-new-amplitude-event" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_y2LR" id="auth-server-1">Auth server<a class="hash-link" href="#auth-server-1" title="Direct link to heading">​</a></h3><ol start="0"><li>Amplitude events are all triggered by activity or flow events, so the first step is to ensure there’s one of those (see above if you need to create a new one).</li><li>If you’re triggering from a specific event, add a new mapping to the <code>EVENTS</code> object in <code>lib/metrics/amplitude.js</code>. If you’re triggering from a set of events, add a mapping to <code>FUZZY_EVENTS</code> instead.</li><li>Add a new test case for the new event to <code>test/local/metrics/amplitude.js</code>. Every event should have its own test case in that module.</li></ol><h3 class="anchor anchorWithStickyNavbar_y2LR" id="content-server-1">Content server<a class="hash-link" href="#content-server-1" title="Direct link to heading">​</a></h3><ol start="0"><li>Amplitude events are all triggered by flow or screen events, so the first step is to ensure there’s one of those (see above if you need to create a new flow event).</li><li>If you’re triggering from a specific event, add a new mapping to the <code>EVENTS</code> object in <code>server/lib/amplitude.js</code>. If you’re triggering from a set of events, add a mapping to <code>FUZZY_EVENTS</code> instead.</li><li>Add a new test case for the new event to <code>tests/server/amplitude.js</code>. Every event should have its own test case in that module.</li></ol></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/mozilla/ecosystem-platform/edit/master/docs/how-tos/working-with-metrics.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_mt2f"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/ecosystem-platform/how-tos/using-a-custom-profile-with-firefox"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Using a Custom Profile with Firefox</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/ecosystem-platform/reference/team-processes/development-process"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Planning and Development</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#create-a-new-activity-event" class="table-of-contents__link toc-highlight">...create a new activity event?</a></li><li><a href="#create-a-new-flow-event" class="table-of-contents__link toc-highlight">...create a new flow event?</a><ul><li><a href="#auth-server" class="table-of-contents__link toc-highlight">Auth server</a></li><li><a href="#content-server" class="table-of-contents__link toc-highlight">Content server</a></li></ul></li><li><a href="#create-a-new-email-event" class="table-of-contents__link toc-highlight">...create a new email event?</a></li><li><a href="#create-a-new-amplitude-event" class="table-of-contents__link toc-highlight">...create a new Amplitude event?</a><ul><li><a href="#auth-server-1" class="table-of-contents__link toc-highlight">Auth server</a></li><li><a href="#content-server-1" class="table-of-contents__link toc-highlight">Content server</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 Mozilla Corporation.</div></div></div></footer></div>
<script src="/ecosystem-platform/assets/js/runtime~main.8d6ee17d.js"></script>
<script src="/ecosystem-platform/assets/js/main.feeacb3a.js"></script>
</body>
</html>