<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<link rel="search" type="application/opensearchdescription+xml" title="Firefox Ecosystem Platform" href="/ecosystem-platform/opensearch.xml"><title data-react-helmet="true">Design, API&#x27;s, Error Codes | Firefox Ecosystem Platform</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://mozilla.github.io/ecosystem-platform/platform/firefox-push/push-design"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Design, API&#x27;s, Error Codes | Firefox Ecosystem Platform"><meta data-react-helmet="true" name="description" content="From [the WebPush"><meta data-react-helmet="true" property="og:description" content="From [the WebPush"><link data-react-helmet="true" rel="shortcut icon" href="/ecosystem-platform/img/firefox-logo.png"><link data-react-helmet="true" rel="canonical" href="https://mozilla.github.io/ecosystem-platform/platform/firefox-push/push-design"><link data-react-helmet="true" rel="alternate" href="https://mozilla.github.io/ecosystem-platform/platform/firefox-push/push-design" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://mozilla.github.io/ecosystem-platform/platform/firefox-push/push-design" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/ecosystem-platform/assets/css/styles.197c61c4.css">
<link rel="preload" href="/ecosystem-platform/assets/js/runtime~main.5c27fe40.js" as="script">
<link rel="preload" href="/ecosystem-platform/assets/js/main.b368de5a.js" as="script">
</head>
<body>
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/ecosystem-platform/"><img src="/ecosystem-platform/img/firefox-logo.png" alt="Ecosystem Platform Logo" class="themedImage_TMUO themedImage--light_4Vu1 navbar__logo"><img src="/ecosystem-platform/img/firefox-logo.png" alt="Ecosystem Platform Logo" class="themedImage_TMUO themedImage--dark_uzRr navbar__logo"><b class="navbar__title">Firefox Ecosystem Platform</b></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/mozilla/ecosystem-platform" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="searchBox_Bc3W"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button class="clean-btn backToTopButton_i9tI" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0"><nav class="menu thin-scrollbar menu_cyFh menuWithAnnouncementBar_+O1J"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/ecosystem-platform/">Introduction</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menuLinkText_OKON">Platform</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Firefox Accounts</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">Firefox Push</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/platform/firefox-push/push-feature">Overview</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/ecosystem-platform/platform/firefox-push/push-design">Design, API&#x27;s, Error Codes</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/platform/firefox-push/push-development">Development Process</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/platform/firefox-push/push-history">History</a></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Firefox Sync</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Subscription Platform</a></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">For FxA Engineers</a></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_eoK2"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_e+kA"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Design, API&#x27;s, Error Codes</h1></header><p>From <a href="https://tools.ietf.org/html/draft-ietf-webpush-protocol-01#section-2" target="_blank" rel="noopener noreferrer">the WebPush
specification</a>:</p><blockquote><p>A general model for push services includes three basic actors: a user agent, a
push service, and an application (server).</p></blockquote><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">    +-------+           +--------------+       +-------------+</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    |  UA   |           | Push Service |       | Application |</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    +-------+           +--------------+       +-------------+</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        |                      |                      |</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        |      Subscribe       |                      |</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        |---------------------&gt;|                      |</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        |       Monitor        |                      |</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        |&lt;====================&gt;|                      |</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        |                      |                      |</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        |          Distribute Push Resource           |</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        |--------------------------------------------&gt;|</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        |                      |                      |</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        :                      :                      :</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        |                      |     Push Message     |</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        |    Push Message      |&lt;---------------------|</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        |&lt;---------------------|                      |</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        |                      |                      |</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>In WebPush, the Push Message is used to wake UA code.</p><p>Currently the Mozilla Push Service supports a proprietary protocol
using a websocket between the UA and the Push Service.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_y2LR" id="bridge-api"></a>Bridge API<a class="hash-link" href="#bridge-api" title="Direct link to heading">#</a></h2><p>Push allows for remote devices to perform some functions using an HTTP
interface. This allows remote devices on Android, iOS, and Amazon to receive
WebPush compatible messages using WebPush endpoints.</p><p>See <a href="/ecosystem-platform/api/push_bridge.html">Push Bridge API Documentation</a>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_y2LR" id="webpush-proprietary-protocol"></a>WebPush Proprietary Protocol<a class="hash-link" href="#webpush-proprietary-protocol" title="Direct link to heading">#</a></h2><p>This documents the current Push Service Protocol used between the UA and
the Push Service.</p><p>The protocol uses a websocket that carries JSON messages in a mostly
request/response style format. The only exception is that after the <strong>Hello</strong>
response the Push Server will send any stored notifications as well as new
notifications when they arrive.</p><p>All websocket connections are secured with TLS (wss://). The Push Server
maintains a list of all previously seen UAID&#x27;s and notifications for UA&#x27;s that
came in while the UA was disconnected. There is no authentication for a given
UAID when reconnecting.</p><p>It is <strong>required</strong> that ChannelID&#x27;s and UAID&#x27;s be UUID&#x27;s.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="messages"></a>Messages<a class="hash-link" href="#messages" title="Direct link to heading">#</a></h3><p>All messages are encoded as JSON. All messages MUST have the following fields:</p><p>messageType string
: Defines the message type</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="handshake"></a>Handshake<a class="hash-link" href="#handshake" title="Direct link to heading">#</a></h3><p>After the WebSocket is established, the UserAgent begins communication by
sending a hello message. The hello message contains the UAID if the UserAgent
has one, either generated by the UserAgent for the first handshake or returned
by the server from an earlier handshake. The UserAgent also transmits the
channelIDs it knows so the server may synchronize its state and optionally the
Megaphone broadcastIDs it&#x27;s subscribed to (if any).</p><p>The server MAY respect this UAID, but it is at liberty to ask the UserAgent to
change its UAID in the response.</p><p>If the UserAgent receives a new UAID, it MUST delete all existing channelIDs and
their associated versions. It MAY then wake up all registered applications
immediately or at a later date by sending them a push-register message.</p><p>A repeated hello message on an established channel may result in the server
disconnecting the client for bad behavior.</p><p>The handshake is considered complete, once the UserAgent has received a reply.</p><p>An UserAgent MUST transmit a hello message only once on its WebSocket. If the
handshake is not completed in the first try, it MUST disconnect the WebSocket
and begin a new connection.</p><p><strong>NOTE</strong>: Applications may request registrations or unregistrations from the
UserAgent, before or when the handshake is in progress. The UserAgent MAY buffer
these or report errors to the application. But it MUST NOT send these requests
to the PushServer until the handshake is completed.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_y2LR" id="useragent---pushserver"></a>UserAgent -&gt; PushServer<a class="hash-link" href="#useragent---pushserver" title="Direct link to heading">#</a></h4><dl><dt>messageType = &quot;hello&quot;</dt><dd></dd><dt>uaid string REQUIRED</dt><dd>If the UserAgent has a previously assigned UAID, it should send it. Otherwise send an empty string.</dd><dt>channelIDs list of strings REQUIRED</dt><dd>If the UserAgent has a list of channelIDs it wants to be notified of, it must pass these, otherwise an empty list.</dd><dt>use_webpush bool OPTIONAL</dt><dd>If the UserAgent wants the WebPush data support for notifications it may include this field with a value of *true*. This field may appear for legacy reasons.</dd><dt>broadcasts object OPTIONAL</dt><dd>If the UserAgent wants to subscribe to specific megaphone broadcasts, it may include this field: an object consisting of broadcastIDs mapped to the UserAgent&#x27;s current broadcast versions.</dd></dl><p>Extra fields: The UserAgent MAY pass any extra JSON data to the PushServer. This
data may include information required to wake up the UserAgent out-of-band. The
PushServer MAY ignore this data.</p><p><strong>Example</strong></p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI json"><pre tabindex="0" class="prism-code language-json codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;messageType&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;hello&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;uaid&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;fd52438f-1c49-41e0-a2e4-98e49833cc9c&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;broadcasts&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;test/broadcast1&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;v3&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;test/broadcast2&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;v0&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_y2LR" id="pushserver---useragent"></a>PushServer -&gt; UserAgent<a class="hash-link" href="#pushserver---useragent" title="Direct link to heading">#</a></h4><dl><dt>messageType = &quot;hello&quot;</dt><dd></dd><dt>uaid string REQUIRED</dt><dd>The UserAgent&#x27;s provided UAID OR a new UAID.</dd><dt>status number REQUIRED</dt><dd>Used to indicate success/failure. MUST be one of: 200 - OK. Successful handshake. 503 - Service Unavailable. Database out of space or offline. Disk space full or whatever other reason due to which the PushServer could not grant this registration. UserAgent SHOULD avoid retrying immediately.</dd><dt>use_webpush bool OPTIONAL</dt><dd>Must match sent value</dd><dt>broadcasts object OPTIONAL</dt><dd>*Only* broadcasts the UserAgent has requested subscriptions to whose version values differ from the UserAgent&#x27;s provided values. It may be empty if the UserAgent is up to date.</dd></dl><p><strong>Example</strong></p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI json"><pre tabindex="0" class="prism-code language-json codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;messageType&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;hello&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;status&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">200</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;uaid&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;fd52438f-1c49-41e0-a2e4-98e49833cc9c&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;broadcasts&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;test/broadcast2&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;v1&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="register"></a>Register<a class="hash-link" href="#register" title="Direct link to heading">#</a></h3><p>The Register message is used by the UserAgent to request that the PushServer
notify it when a channel changes. Since channelIDs are associated with only one
UAID, this effectively creates the channel, while unregister destroys the
channel.</p><p>The channelID is chosen by the UserAgent because it also acts like a nonce for
the Register message itself. Because of this PushServers MAY respond out of
order to multiple register messages or messages may be lost without compromising
correctness of the protocol.</p><p>The request is considered successful only after a response is received with a
status code of 200. On success the UserAgent MUST:</p><ul><li>Update its persistent storage based on the response</li><li>Notify the application of a successful registration.</li><li>On error, the UserAgent MUST notify the application as soon as possible.</li></ul><p><strong>NOTE</strong>: The register call is made by the UserAgent on behalf of an
application. The UserAgent SHOULD have reasonable timeouts in place so that
the application is not kept waiting for too long if the server does not
respond or the UserAgent has to retry the connection.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_y2LR" id="useragent---pushserver-1"></a>UserAgent -&gt; PushServer<a class="hash-link" href="#useragent---pushserver-1" title="Direct link to heading">#</a></h4><dl><dt>messageType = &quot;register&quot;</dt><dd></dd><dt>channelID string REQUIRED</dt><dd>A unique identifier generated by the UserAgent, distinct from any existing channelIDs it has registered. It is RECOMMENDED that this is a UUIDv4 token.</dd></dl><p><strong>Example</strong></p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI json"><pre tabindex="0" class="prism-code language-json codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;messageType&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;register&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;channelID&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;d9b74644-4f97-46aa-b8fa-9393985cd6cd&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_y2LR" id="pushserver---useragent-1"></a>PushServer -&gt; UserAgent<a class="hash-link" href="#pushserver---useragent-1" title="Direct link to heading">#</a></h4><dl><dt>messageType = &quot;register&quot;</dt><dd></dd><dt>channelID string REQUIRED</dt><dd>This MUST be the same as the channelID sent by the UserAgent in the register request that this message is a response to.</dd><dt>status number REQUIRED</dt><dd>Used to indicate success/failure. MUST be one of: 200 - OK. Success. Idempotent: If the PushServer receives a register for the same channelID from a UserAgent which already has a registration for the channelID, it should still respond with success. 409 - Conflict. The chosen ChannelID is already in use and NOT associated with this UserAgent. UserAgent SHOULD retry with a new ChannelID as soon as possible. 500 - Internal server error. Database out of space or offline. Disk space full or whatever other reason due to which the PushServer could not grant this registration. UserAgent SHOULD avoid retrying immediately.</dd><dt>pushEndpoint string REQUIRED</dt><dd>Should be the URL sent to the application by the UserAgent. AppServers will contact the PushServer at this URL to update the version of the channel identified by channelID.</dd></dl><p><strong>Example</strong></p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI json"><pre tabindex="0" class="prism-code language-json codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token property" style="color:#36acaa">&quot;messageType&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;register&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token property" style="color:#36acaa">&quot;channelID&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;d9b74644-4f97-46aa-b8fa-9393985cd6cd&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token property" style="color:#36acaa">&quot;status&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">200</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token property" style="color:#36acaa">&quot;pushEndpoint&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;http://pushserver.example.org/d9b74644&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="unregister"></a>Unregister<a class="hash-link" href="#unregister" title="Direct link to heading">#</a></h3><p>Unregistration is <strong>required</strong> for the WebPush.</p><p>PushServers MUST support it. UserAgents SHOULD support it.</p><p>The unregister is required only between the App and the UserAgent, so that the
UserAgent stops notifying the App when the App is no longer interested in a
pushEndpoint.</p><p>The unregister is also useful to the AppServer, because it should stop sending
notifications to an endpoint the App is no longer monitoring. Even then, it is
really an optimization so that the AppServer need not have some sort of garbage
collection mechanism to clean up endpoints at intervals of time.</p><p>The PushServer MUST implement unregister, but need not rely on it. Well behaved
AppServers will stop notifying it of unregistered endpoints automatically. Well
behaved UserAgents won&#x27;t notify their apps of unregistered updates either. So
the PushServer can continue to process notifications and pass them on to
UserAgents, when it has not been told about the unregistration.</p><p>When an App calls unregister(endpoint) it is RECOMMENDED that the UserAgent
follow these steps:</p><ol><li>Remove its local registration first, for example from the database.
This will allow it to immediately start ignoring updates.</li><li>Notify the App that unregistration succeeded.</li><li>Fire off an unregister message to the PushServer</li></ol><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_y2LR" id="useragent---pushserver-2"></a>UserAgent -&gt; PushServer<a class="hash-link" href="#useragent---pushserver-2" title="Direct link to heading">#</a></h4><dl><dt>messageType = &quot;unregister&quot;</dt><dd></dd><dt>channelID string REQUIRED</dt><dd>ChannelID that should be unregistered.</dd></dl><p><strong>Example</strong></p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI json"><pre tabindex="0" class="prism-code language-json codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;messageType&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;unregister&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;channelID&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;d9b74644-4f97-46aa-b8fa-9393985cd6cd&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_y2LR" id="pushserver---useragent-2"></a>PushServer -&gt; UserAgent<a class="hash-link" href="#pushserver---useragent-2" title="Direct link to heading">#</a></h4><dl><dt>messageType = &quot;unregister&quot;</dt><dd></dd><dt>channelID string REQUIRED</dt><dd>This MUST be the same as the channelID sent by the UserAgent in the unregister request that this message is a response to.</dd><dt>status number REQUIRED</dt><dd>Used to indicate success/failure. MUST be one of: 200 - OK. Success. Idempotent: If the PushServer receives a unregister for a non-existent channelID it should respond with success. If the channelID is associated with a DIFFERENT UAID, it MUST NOT delete the channelID, but still MUST respond with success to this UserAgent. 500 - Internal server error. Database offline or whatever other reason due to which the PushServer could not grant this unregistration. UserAgent SHOULD avoid retrying immediately.</dd></dl><p><strong>Example</strong></p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI json"><pre tabindex="0" class="prism-code language-json codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;messageType&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;unregister&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;channelID&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;d9b74644-4f97-46aa-b8fa-9393985cd6cd&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;status&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">200</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="ping"></a>Ping<a class="hash-link" href="#ping" title="Direct link to heading">#</a></h3><p>The connection to the Push Server may be lost due to network issues. When the
UserAgent detects loss of network, it should reconnect. There are situations in
which the TCP connection dies without either end discovering it immediately. The
UserAgent MAY send a ping approximately every 30 minutes and expect a reply
from the server in a reasonable time (The Mozilla UserAgent uses 10 seconds). If
no data is received, the connection should be presumed closed and a new
connection started.</p><p>A UserAgent MUST NOT send a Ping more frequently than once a minute or its
connection MAY be dropped.</p><p>The UserAgent should consider normal communications as an indication that the
socket is working properly. It SHOULD send the ping packet only if no activity
has occurred in the past 30 minutes.</p><p><strong>Note</strong>: This section is included for relevant historical purposes as the
current implementation sends WebSocket Ping frames every 5 minutes which is
sufficient to keep the connection alive. As such, client-sent Ping&#x27;s are no
longer needed.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_y2LR" id="useragent---pushserver-3"></a>UserAgent -&gt; PushServer<a class="hash-link" href="#useragent---pushserver-3" title="Direct link to heading">#</a></h4><p>The 2-character string {} is sent. This is a valid JSON object that requires no
alternative processing on the server, while keeping transmission size small.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_y2LR" id="pushserver---useragent-3"></a>PushServer -&gt; UserAgent<a class="hash-link" href="#pushserver---useragent-3" title="Direct link to heading">#</a></h4><p>The PushServer may reply with any data. The UserAgent is only concerned about
the state of the connection. The PushServer may deliver pending notifications or
other information. If there is no pending information to be sent, it is
RECOMMENDED that the PushServer also reply with the string {}.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="notification"></a>Notification<a class="hash-link" href="#notification" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_y2LR" id="appserver---pushserver"></a>AppServer -&gt; PushServer<a class="hash-link" href="#appserver---pushserver" title="Direct link to heading">#</a></h4><p>The AppServer MUST make a HTTP PUT request to the Endpoint received from the
App, or a HTTP POST if using the WebPush extension.</p><p>If no request body is present, the server MAY presume the version to be the
current server UTC.</p><p>If the request body is present, the request MUST contain the string &quot;version=N&quot;
and the Content-Type MUST be application/x-www-form-urlencoded.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_y2LR" id="pushserver---appserver"></a>PushServer -&gt; AppServer<a class="hash-link" href="#pushserver---appserver" title="Direct link to heading">#</a></h4><p>The HTTP response status code indicates if the request was successful.</p><ul><li><p>200 - OK. The PushServer will attempt to deliver a notification to the
associated UserAgent.</p></li><li><p>500 - Something went wrong with the server. Rare, but the AppServer should try
again.</p></li></ul><p>The HTTP response body SHOULD be empty.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_y2LR" id="pushserver---useragent-4"></a>PushServer -&gt; UserAgent<a class="hash-link" href="#pushserver---useragent-4" title="Direct link to heading">#</a></h4><p>Notifications are acknowledged by the UserAgent. PushServers should retry unacknowledged notifications every 60 seconds. If the version of an unacknowledged notification is updated, the PushServer MAY queue up a new notification for this channelID and the new version, and remove the old notification from the pending queue.</p><dl><dt>messageType = &quot;notification&quot;</dt><dd></dd></dl><p>The following attributes are present
in each notification. A
notification message is sent for every stored notification individually, as well
as new notifications.</p><dl><dt>channelID string REQUIRED</dt><dd>ChannelID of the notification</dd><dt>version string REQUIRED</dt><dd>Version of the notification sent</dd><dt>headers map OPTIONAL</dt><dd>Encryption headers sent along with the data. Present only if data was sent.</dd><dt>data string OPTIONAL</dt><dd>Data payload, if included. This string is Base64 URL-encoded.</dd></dl><p><strong>Example</strong></p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI json"><pre tabindex="0" class="prism-code language-json codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;messageType&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;notification&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;channelID&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;431b4391-c78f-429a-a134-f890b5adc0bb&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;version&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;a7695fa0-9623-4890-9c08-cce0231e4b36:d9b74644-4f97-46aa-b8fa-9393985cd6cd&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_y2LR" id="useragent---pushserver-4"></a>UserAgent -&gt; PushServer<a class="hash-link" href="#useragent---pushserver-4" title="Direct link to heading">#</a></h4><p>It is RECOMMENDED that the UserAgent try to batch all pending acknowledgements
into fewer messages if bandwidth is a concern. The ack MUST be sent as soon as
the message has been processed, otherwise the
Push Server MAY cease sending notifications to avoid holding excessive client
state.</p><dl><dt>messageType = &quot;ack&quot;</dt><dd></dd><dt>updates list</dt><dd>The list contains one or more <code>{&quot;channelID&quot;: channelID, &quot;version&quot;: N}</code> pairs.</dd></dl><p><strong>Example</strong></p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI json"><pre tabindex="0" class="prism-code language-json codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;messageType&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ack&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;updates&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">&quot;channelID&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;431b4391-c78f-429a-a134-f890b5adc0bb&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">&quot;version&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">23</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">&quot;channelID&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;a7695fa0-9623-4890-9c08-cce0231e4b36&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">&quot;version&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">42</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="broadcast"></a>Broadcast<a class="hash-link" href="#broadcast" title="Direct link to heading">#</a></h3><p>When a UserAgent&#x27;s subscribed broadcasts are updated, PushServers send
broadcast messages with no expected reply.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_y2LR" id="pushserver---useragent-5"></a>PushServer -&gt; UserAgent<a class="hash-link" href="#pushserver---useragent-5" title="Direct link to heading">#</a></h4><dl><dt>messageType = &quot;broadcast&quot;</dt><dd></dd><dt>broadcasts object OPTIONAL</dt><dd>*Only* broadcasts the UserAgent has requested subscriptions to whose new version values differ from the UserAgent&#x27;s provided values.</dd></dl><p><strong>Example</strong></p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI json"><pre tabindex="0" class="prism-code language-json codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;messageType&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;broadcast&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;broadcasts&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;test/broadcast1&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;v4&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="broadcast-subscribe"></a>Broadcast Subscribe<a class="hash-link" href="#broadcast-subscribe" title="Direct link to heading">#</a></h3><p>UserAgents subscribe to broadcasts during the hello handshake but may also
subscribe to additional broadcasts afterwards. There is no expected reply to
this message.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_y2LR" id="useragent---pushserver-5"></a>UserAgent -&gt; PushServer<a class="hash-link" href="#useragent---pushserver-5" title="Direct link to heading">#</a></h4><dl><dt>messageType = &quot;broadcast_subscribe&quot;</dt><dd></dd><dt>broadcasts object REQUIRED</dt><dd>New broadcasts the UserAgent is requesting subscriptions to and their current broadcast versions.</dd></dl><p><strong>Example</strong></p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI json"><pre tabindex="0" class="prism-code language-json codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;messageType&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;broadcast_subscribe&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;broadcasts&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;test/new-broadcast22&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;v8&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_y2LR" id="error-codes"></a>Error Codes<a class="hash-link" href="#error-codes" title="Direct link to heading">#</a></h2><p>The Mozilla Push Service may return a variety of error codes depending on what
went wrong in the request.</p><p>Autopush uses error codes based on <a href="https://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html" target="_blank" rel="noopener noreferrer">HTTP response codes</a>.
An error response will contain a JSON body including an additional error information.</p><p>Unless otherwise specified, all calls return one the following error statuses:</p><ul><li><p>20x - <strong>Success</strong> - The message was accepted for transmission to the client. Please note that the message may still be rejected by the User Agent if there is an error with the message&#x27;s encryption.</p></li><li><p>301 - <strong>Moved + <code>Location:</code></strong> if <code>{client_token}</code> is invalid (Bridge API Only) - Bridged services (ones that run over third party services like GCM and APNS), may require a new URL be used. Please stop using the old URL immediately and instead use the new URL provided.</p></li><li><p>400 - <strong>Bad Parameters</strong> -- One or more of the parameters specified is invalid. See the following sub-errors indicated by <code>errno</code></p><ul><li><p>errno 101 - Missing necessary crypto keys - One or more required crypto key elements are missing from this transaction. Refer to the <a href="https://datatracker.ietf.org/doc/draft-ietf-httpbis-encryption-encoding/" target="_blank" rel="noopener noreferrer">appropriate specification</a> for the requested content-type.</p></li><li><p>errno 108 - Router type is invalid - The URL contains an invalid router type, which may be from URL corruption or an unsupported bridge. Refer to <a href="/ecosystem-platform/api/push_bridge.html">bridge API</a>.</p></li><li><p>errno 110 - Invalid crypto keys specified - One or more of the crytpo key elements are invalid. Refer to the <a href="https://datatracker.ietf.org/doc/draft-ietf-httpbis-encryption-encoding/" target="_blank" rel="noopener noreferrer">appropriate specification</a> for the requested content-type.</p></li><li><p>errno 111 - Missing Required Header - A required crypto element header is missing. Refer to the <a href="https://datatracker.ietf.org/doc/draft-ietf-httpbis-encryption-encoding/" target="_blank" rel="noopener noreferrer">appropriate specification</a> for the requested content-type.</p><ul><li>Missing TTL Header - Include the Time To Live header (<a href="https://tools.ietf.org/html/draft-ietf-webpush-protocol#section-6.2" target="_blank" rel="noopener noreferrer">IETF WebPush protocol §6.2</a>)</li><li>Missing Crypto Headers - Include the appropriate encryption headers (<a href="https://webpush-wg.github.io/webpush-encryption/#rfc.section.3.2" target="_blank" rel="noopener noreferrer">WebPush Encryption §3.2</a> and <a href="https://tools.ietf.org/html/draft-ietf-webpush-vapid-02#section-4" target="_blank" rel="noopener noreferrer">WebPush VAPID §4</a>)</li></ul></li><li><p>errno 112 - Invalid TTL header value - The Time To Live &quot;TTL&quot; header contains an invalid or unreadable value. Please change to a number of seconds that this message should live, between 0 (message should be dropped immediately if user is unavailable) and 2592000 (hold for delivery within the next approximately 30 days).</p></li><li><p>errno 113 - Invalid Topic header value - The Topic header contains an invalid or unreadable value. Please use only ASCII alphanumeric values [A-Za-z0-9] and a maximum length of 32 bytes..</p></li></ul></li><li><p>401 - <strong>Bad Authorization</strong> - <code>Authorization</code> header is invalid or missing. See the <a href="https://datatracker.ietf.org/doc/draft-ietf-webpush-vapid/" target="_blank" rel="noopener noreferrer">VAPID specification</a>.</p><ul><li>errno 109 - Invalid authentication</li></ul></li><li><p>404 - <strong>Endpoint Not Found</strong> - The URL specified is invalid and should not be used again.</p><ul><li>errno 102 - Invalid URL endpoint</li></ul></li><li><p>410 - <strong>Endpoint Not Valid</strong> - The URL specified is no longer valid and should no longer be used. A User has become permanently unavailable at this URL.</p><ul><li>errno 103 - Expired URL endpoint</li><li>errno 105 - Endpoint became unavailable during request</li><li>errno 106 - Invalid subscription</li></ul></li><li><p>413 - <strong>Payload too large</strong> - The body of the message to send is too large. The max data that can be sent is 4028 characters. Please reduce the size of the message.</p><ul><li>errno 104 - Data payload too large</li></ul></li><li><p>500 - <strong>Unknown server error</strong> - An internal error occurred within the Push Server.</p><ul><li>errno 999 - Unknown error</li></ul></li><li><p>502 - <strong>Bad Gateway</strong> - The Push Service received an invalid response from an upstream Bridge service.</p><ul><li>errno 900 - Internal Bridge misconfiguration</li><li>errno 901 - Invalid authentication</li><li>errno 902 - An error occurred while establishing a connection</li><li>errno 903 - The request timed out</li></ul></li><li><p>503 - <strong>Server temporarily unavailable.</strong> - The Push Service is currently unavailable. See the error number &quot;errno&quot; value to see if retries are available.</p><ul><li>errno 201 - Use exponential back-off for retries</li><li>errno 202 - Immediate retry ok</li></ul></li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/mozilla/ecosystem-platform/edit/main/website/docs/platform/firefox-push/push-design.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_mt2f"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/ecosystem-platform/platform/firefox-push/push-feature"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« Overview</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/ecosystem-platform/platform/firefox-push/push-development"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Development Process »</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#bridge-api" class="table-of-contents__link">Bridge API</a></li><li><a href="#webpush-proprietary-protocol" class="table-of-contents__link">WebPush Proprietary Protocol</a><ul><li><a href="#messages" class="table-of-contents__link">Messages</a></li><li><a href="#handshake" class="table-of-contents__link">Handshake</a></li><li><a href="#register" class="table-of-contents__link">Register</a></li><li><a href="#unregister" class="table-of-contents__link">Unregister</a></li><li><a href="#ping" class="table-of-contents__link">Ping</a></li><li><a href="#notification" class="table-of-contents__link">Notification</a></li><li><a href="#broadcast" class="table-of-contents__link">Broadcast</a></li><li><a href="#broadcast-subscribe" class="table-of-contents__link">Broadcast Subscribe</a></li></ul></li><li><a href="#error-codes" class="table-of-contents__link">Error Codes</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 Mozilla Corporation.</div></div></div></footer></div>
<script src="/ecosystem-platform/assets/js/runtime~main.5c27fe40.js"></script>
<script src="/ecosystem-platform/assets/js/main.b368de5a.js"></script>
</body>
</html>