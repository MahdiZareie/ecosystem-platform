<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.14">
<link rel="search" type="application/opensearchdescription+xml" title="Firefox Ecosystem Platform" href="/ecosystem-platform/opensearch.xml"><title data-react-helmet="true">Localization | Firefox Ecosystem Platform</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://mozilla.github.io/ecosystem-platform/reference/localization"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Localization | Firefox Ecosystem Platform"><meta data-react-helmet="true" name="description" content="Current as of October 17th, 2019"><meta data-react-helmet="true" property="og:description" content="Current as of October 17th, 2019"><link data-react-helmet="true" rel="icon" href="/ecosystem-platform/img/firefox-logo.png"><link data-react-helmet="true" rel="canonical" href="https://mozilla.github.io/ecosystem-platform/reference/localization"><link data-react-helmet="true" rel="alternate" href="https://mozilla.github.io/ecosystem-platform/reference/localization" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://mozilla.github.io/ecosystem-platform/reference/localization" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://RFM5H13DFK-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/ecosystem-platform/assets/css/styles.9f158ee2.css">
<link rel="preload" href="/ecosystem-platform/assets/js/runtime~main.f96db157.js" as="script">
<link rel="preload" href="/ecosystem-platform/assets/js/main.d44bc471.js" as="script">
</head>
<body>
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/ecosystem-platform/"><div class="navbar__logo"><img src="/ecosystem-platform/img/firefox-logo.png" alt="Ecosystem Platform Logo" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/ecosystem-platform/img/firefox-logo.png" alt="Ecosystem Platform Logo" class="themedImage_TMUO themedImage--dark_uzRr"></div><b class="navbar__title">Firefox Ecosystem Platform</b></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/mozilla/ecosystem-platform" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="searchBox_Utm0"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_i9tI" type="button"></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0"><nav class="menu thin-scrollbar menu_cyFh"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/ecosystem-platform/">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menuLinkText_OKON">For Relying Parties</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" tabindex="0" href="/ecosystem-platform/platform/firefox-accounts/fxa-overview">Firefox Accounts</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" tabindex="0" href="/ecosystem-platform/platform/sub-plat/sub-plat-overview">Subscription Platform</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--active menuLinkText_OKON">For FxA Engineers</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" tabindex="0" href="/ecosystem-platform/tutorials/development-setup">Tutorials</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" tabindex="0" href="/ecosystem-platform/how-tos/creating-an-account-locally">How-to Guides</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_TwRn" tabindex="0" href="/ecosystem-platform/reference/browser-support">Reference</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/reference/browser-support">Browser Support</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/reference/development-process">Development Process</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/reference/work-breakdown-process">Work Breakdown Process</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/reference/release-process">Release Process</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/reference/incident-response">Incident Response</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/reference/how-does-fxa-process-email">How does FxA process email?</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/ecosystem-platform/reference/localization">Localization</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/reference/metrics">Metrics</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/reference/jwt-access-tokens">JWT Access Tokens</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/reference/storybook-deploys-with-circleci">Storybook Deploys with CircleCI</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/reference/webchannels-in-firefox-desktop-fennec">WebChannels in Firefox Desktop &amp; Fennec</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/reference/webchannels-in-fenix-webextensions">WebChannels in Fenix &amp; WebExtensions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/reference/tests-in-circleci">Tests in CircleCI</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/reference/functional-testing">Functional Tests</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/reference/automation-testplan">Automation Test Plan</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/reference/internal-api-documentation">Internal API Documentation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/reference/experiments-ab-testing">Experiments &amp; A/B Testing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/reference/interruptive-surveys">Interruptive Surveys</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/reference/system-diagrams">System Diagrams</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/reference/application-logging">Application Logging</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/reference/scheduled-maintenance">Scheduled Maintenance</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/reference/mobile-specifics">Mobile Specifics</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/reference/architectural-decision-records">Architectural Decision Records</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/reference/github-strategies">GitHub Strategies</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" tabindex="0" href="/ecosystem-platform/explanation/onepw-protocol">Explanation</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/additional-docs">Additional Docs</a></li></ul></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_eoK2"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_e+kA"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Localization</h1></header><p>Current as of <code>October 17th, 2019</code></p><p>Translations for FxA&#x27;s content and auth servers are located in the
<a href="https://github.com/mozilla/fxa-content-server-l10n/" target="_blank" rel="noopener noreferrer">https://github.com/mozilla/fxa-content-server-l10n/</a> repo.</p><p>Within the <a href="https://github.com/mozilla/fxa-content-server-l10n/tree/master/locale" target="_blank" rel="noopener noreferrer">locale/*</a> directories, 2 files exist:</p><ul><li>client.json - for the content server (UI, frontend)</li><li>server.json - for the server side strings (emails, backend templates)</li></ul><p>The l10n infrastructure used by FxA’s content and auth servers
is based on <a href="https://www.gnu.org/software/gettext/" target="_blank" rel="noopener noreferrer">gettext</a>. When localization was first
added to FxA, the only l10n format supported by Mozilla’s l10n
system <a href="https://pontoon.mozilla.org/" target="_blank" rel="noopener noreferrer">Pontoon</a> was gettext as the newer format based
on <a href="https://projectfluent.org/" target="_blank" rel="noopener noreferrer">Fluent</a> did not yet exist.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="extraction-process">Extraction process<a class="hash-link" href="#extraction-process" title="Direct link to heading">​</a></h2><ul><li>Timed <a href="https://github.com/mozilla/fxa-content-server-l10n/blob/b54413751c27964c8f6db9bc94904ffe50036c4c/.circleci/config.yml#L60" target="_blank" rel="noopener noreferrer">cron job on Circle</a>, run on Fridays at 08.00 PST.</li><li>Calls <a href="https://github.com/mozilla/fxa-content-server-l10n/blob/master/scripts/extract-and-pull-request.sh" target="_blank" rel="noopener noreferrer">extract-and-pull-request.sh</a> which extracts strings and creates a branch with a random name.<ul><li>In turn calls <a href="https://github.com/mozilla/fxa-content-server-l10n/blob/ed36b87ccf22a4420fd7a65ecfd9f6eb89c45c15/scripts/extract_strings.sh" target="_blank" rel="noopener noreferrer">extract_strings.sh</a></li><li>See <a href="#extraction-process-deep-dive">Extraction process deep dive</a> for more info.</li></ul></li><li>Branch becomes a pull request on the fxa-content-server-l10n repository which must be merged by a developer after doing cursory checks.<ul><li>Check to ensure new/changed strings “look right”.</li></ul></li><li>Once merged, <a href="https://pontoon.mozilla.org/projects/firefox-accounts/" target="_blank" rel="noopener noreferrer">Pontoon automatically pulls in string</a> changes and notifies localizers.</li></ul><h2 class="anchor anchorWithStickyNavbar_y2LR" id="localization-process">Localization process<a class="hash-link" href="#localization-process" title="Direct link to heading">​</a></h2><ul><li>Localizers are notified that FxA’s strings have changed.</li><li>Localizers open <a href="https://pontoon.mozilla.org/es-AR/firefox-accounts/" target="_blank" rel="noopener noreferrer">Pontoon to their locale&#x27;s FxA project</a>.</li><li>Localizers make updates, a review request is issued.</li><li>Reviewer accepts changes.</li><li>Changes are pushed back to the <a href="https://github.com/mozilla/fxa-content-server-l10n/" target="_blank" rel="noopener noreferrer">fxa-content-server-l10n</a> repo as a commit to master.<ul><li>Every commit to master causes a linting job to be run on Travis.<ul><li>The linter checks to ensure:<ul><li>All HTML within the translations is well formed, e.g., no unclosed anchor tags.</li><li>No unexpected HTML elements exist.</li><li>No unexpected HTML element attributes exist.</li><li>No unexpected HTML element attribute values exist.</li><li>All named variables in the translations exist in the English strings.</li></ul></li><li>These checks prevent:<ul><li>l10n being used as an attack vector since HTML element attributes can contain JavaScript.</li><li>There was at least one case of a translation including unexpected HTML that contained a link to an external site.</li><li>There have been multiple cases of malformed HTML which ended up causing templates to be incorrectly rendered.</li></ul></li><li>If any of the lint checks fail the <a href="https://github.com/mozilla/fxa-content-server-l10n/blob/master/.travis.yml#L19" target="_blank" rel="noopener noreferrer">folks listed here are notified</a> and corrections are made.</li></ul></li></ul></li></ul><h2 class="anchor anchorWithStickyNavbar_y2LR" id="import-to-production-process">Import to production process<a class="hash-link" href="#import-to-production-process" title="Direct link to heading">​</a></h2><p>Every time a content server or auth server Docker image is created, the latest version of the <a href="https://github.com/mozilla/fxa/blob/main/packages/fxa-content-server/scripts/download_l10n.sh" target="_blank" rel="noopener noreferrer">fxa-content-server-l10n repo is downloaded</a> and bundled with the docker image. See <a href="#import-process-deep-dive">Import Process Deep Dive</a> for more info on how this process works.</p><p>The downside to how this process works is that strings are only pulled into production whenever a docker image is created. Any given train is typically cut on a Monday and deployed the following Monday. If the last docker image for the train is created on the first Monday, and deployed on the 2nd Monday, and entire week of translations are not deployed to production. This usually isn’t as much of a problem in reality because we generally create at least 1 point release during that second week before going to production.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="a-bit-about-gettext">A bit about gettext<a class="hash-link" href="#a-bit-about-gettext" title="Direct link to heading">​</a></h2><p>While gettext does not have the expressive power of Fluent, it has on the whole been sufficient for our needs. Gettext translations are held in .po (Portable Object) files with a relatively simple format. A simple example from the <a href="https://github.com/mozilla/fxa-content-server-l10n/blob/b54413751c27964c8f6db9bc94904ffe50036c4c/locale/lt/LC_MESSAGES/client.po#L18:L20" target="_blank" rel="noopener noreferrer">current Lithuanian translations</a>:</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">#: .es5/views/confirm_reset_password.js:195</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">msgid &quot;Password reset&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">msgstr &quot;Slaptažodžio atkūrimas&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>The first line (#: .es5…) says where in the source the string is located.
The second line (msgid) gives the string in English.
The third line (msgstr) gives the translation.</p><p>If no translation is provided, msgstr is an empty string:</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">#: .es5/views/confirm_reset_password.js:195</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">msgid &quot;Password reset&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">msgstr &quot;&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Basic string interpolation can be done using named variables, another <a href="https://github.com/mozilla/fxa-content-server-l10n/blob/b54413751c27964c8f6db9bc94904ffe50036c4c/locale/lt/LC_MESSAGES/client.po#L72:L74" target="_blank" rel="noopener noreferrer">example from the Lithuation translations</a>:</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">#: .es5/views/ready.js:75</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">msgid &quot;Account notifications will now also be sent to %(secondaryEmailVerified)s.&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">msgstr &quot;Paskyros pranešimai dabar taip pat bus siunčiami adresu %(secondaryEmailVerified)s.&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>When translated by the content or auth-servers, secondaryEmailVerified will be passed as a variable to the translate function, causing %(secondaryEmailVerified)s to be replaced with the passed in value.</p><p>Within the content and auth server, all strings that are to be translated are wrapped in a <code>t</code> method. <code>t</code> is a signal to the l10n extraction script that the embedded string is meant for translation. Within mustache templates, strings meant for extraction are wrapped in {{#t}}{{/t}} or {{#unsafeTranslate}}{{/unsafeTranslate}} tags.</p><p>Gettext comments can be used to provide extra context to translators to allow them to effectively translate strings that could be vague in different languages. For example, <a href="https://github.com/mozilla/fxa/blob/dfc7a258402840e35139fd918c7bc93bc39ca9b7/packages/fxa-content-server/app/scripts/views/sign_in.js#L58:L61" target="_blank" rel="noopener noreferrer">from the sign_in view on the content server</a>:</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">/// submit button</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const buttonSignInText = this.translate(t(&#x27;Sign in&#x27;), {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  msgctxt: &#x27;submit button&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">});</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>The triple-slash /// is <a href="https://github.com/mozilla/fxa-content-server-l10n/blob/ed36b87ccf22a4420fd7a65ecfd9f6eb89c45c15/locale/es/LC_MESSAGES/client.po#L26" target="_blank" rel="noopener noreferrer">extracted as a gettext comment</a>:</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">#. submit button</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">msgid &quot;Sign in&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">msgstr &quot;Identificarse&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Contrast this with another usage of <a href="https://github.com/mozilla/fxa-content-server-l10n/blob/ed36b87ccf22a4420fd7a65ecfd9f6eb89c45c15/locale/es/LC_MESSAGES/client.po#L2483" target="_blank" rel="noopener noreferrer">“Sign in” in the header text</a> which has a different connotation in Spanish:</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">#. msgctxt &quot;header text&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">msgid &quot;Sign in&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">msgstr &quot;Iniciar sesión&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="content-server-gotchas">Content server gotchas<a class="hash-link" href="#content-server-gotchas" title="Direct link to heading">​</a></h3><p>Strings within mustache templates wrapped a {{#t}}{{/t}} tag are HTML escaped by default to prevent unexpected HTML from being written to the DOM. HTML can be written to the DOM from a string that is translated using the {{#unsafeTranslate}}{{/unsafeTranslate}} tag. Within an unsafeTranslate tag, named variables must contain the escaped prefix to remind developers that the variable must be HTML escaped before being written.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="extraction-process-deep-dive">Extraction process deep dive<a class="hash-link" href="#extraction-process-deep-dive" title="Direct link to heading">​</a></h2><p>Here we go into more detail about the internals of extract-and-pull-request.sh. The call to <a href="https://github.com/mozilla/fxa-content-server-l10n/blob/ed36b87ccf22a4420fd7a65ecfd9f6eb89c45c15/scripts/extract_strings.sh" target="_blank" rel="noopener noreferrer">extract_strings.sh</a> needs the most explanation.</p><p>String extraction on both the content and auth server are facilitated using a grunt task called l10n-extract. The content server is a mixture of JavaScript, TypeScript, JSX, Handlebars, and Mustache, each of these file types may contain translatable strings. The jsx-gettext parser was written by Zach Carter, a former FxA teammate at a time when no generic solution existed to extract strings from a variety of file types. Jsx-gettext is able to handle standard JavaScript, TypeScript, JSX, Handlebars, and Mustache, however it is unable to parse JavaScript extensions such as babel-specific dynamic imports and class properties. The first major step in the string extraction process is to have <a href="https://github.com/mozilla/fxa/blob/dfc7a258402840e35139fd918c7bc93bc39ca9b7/packages/fxa-content-server/grunttasks/l10n-extract.js#L21" target="_blank" rel="noopener noreferrer">babel convert JavaScript, TypeScript, and JSX into ES5 Javascript</a>.</p><ul><li>Use <a href="https://github.com/mozilla/fxa/blob/dfc7a258402840e35139fd918c7bc93bc39ca9b7/packages/fxa-content-server/grunttasks/l10n-extract.js#L21" target="_blank" rel="noopener noreferrer">babel to convert non-standard JavaScript, JSX, and TypeScript into ES5 JavaScript</a>.</li><li>jsx-gettext parser analyses source files looking for the keywords <a href="https://github.com/mozilla/fxa/blob/dfc7a258402840e35139fd918c7bc93bc39ca9b7/packages/fxa-content-server/grunttasks/l10n-extract.js#L54" target="_blank" rel="noopener noreferrer">‘t’, and ‘unsafeTranslate’</a>, saving a list of strings along with source location annotations to <!-- -->&lt;<!-- -->package<!-- -->&gt;<!-- -->/locale/templates/LC_MESSAGES/client.pot and <!-- -->&lt;<!-- -->package<!-- -->&gt;<!-- -->/locale/templates/LC_MESSAGES/server.pot<ul><li>The .pot files contain only the current strings that need to be translated.</li></ul></li><li>For <a href="https://github.com/mozilla/fxa-content-server-l10n/tree/master/locale" target="_blank" rel="noopener noreferrer">each locale in the fxa-content-server-l10n repo</a>, the strings from the .pot files are <a href="https://github.com/mozilla/fxa-content-server-l10n/blob/ed36b87ccf22a4420fd7a65ecfd9f6eb89c45c15/scripts/merge_po.sh" target="_blank" rel="noopener noreferrer">merged with existing strings</a> in .po files.<ul><li>Translations of strings in the .pot file that are already in the existing .po files are kept.</li><li>New entries are added for strings in the .pot file that have no entries in the existing .po files.</li><li>Any strings in the .po files that no longer have entries in the .pot files are commented out.</li></ul></li></ul><h2 class="anchor anchorWithStickyNavbar_y2LR" id="import-process-deep-dive">Import process deep dive<a class="hash-link" href="#import-process-deep-dive" title="Direct link to heading">​</a></h2><p>Here we go into more detail about how strings are imported from the <a href="https://github.com/mozilla/fxa-content-server-l10n/" target="_blank" rel="noopener noreferrer">fxa-content-server-l10n repo</a> into FxA. This section assumes <a href="#localization-process">changes made on Pontoon have already been merged into FxA</a> and the lint tests have passed.</p><p>The major issue here is that translations on Pontoon are held in gettext .po files and the FxA content server needs translations in a format that is understood by JavaScript. We chose a JSON key-&gt;value format, meaning we need to convert .po files to .json.</p><p>A second issue is initial page load speed. Our initial approach was to create .json files that could be loaded via XHR requests once the initial FxA JavaScript bundle was loaded, delaying initial render until the translated strings were loaded. We found this approach delayed initial render significantly, sometimes by several hundred milliseconds. To speed up the initial render, translations are embedded into the initial JavaScript bundle, resulting in one JavaScript bundle for each translation.</p><p>We deploy static resources such as JavaScript to a 3rd party CDN (Amazon), and use <a href="https://developer.mozilla.org/docs/Web/Security/Subresource_Integrity" target="_blank" rel="noopener noreferrer">Subresource Integrity (SRI)</a> to ensure the CDN does not modify those resources. SRI hashes must be declared in the HTML for any scripts included in the HTML, and must be included in the request for any scripts loaded dynamically. To minimize the number of CPU cycles needed to render any given page, we pre-render as much as possible during the build step, resulting in one set of web pages for each translation, each page containing a link to the build JavaScript bundle along with its SRI hash. All this means bundling the translations did improve initial page render at the cost of significant build complexity.</p><ul><li>During a Docker image build, the <a href="https://github.com/mozilla/fxa/blob/dfc7a258402840e35139fd918c7bc93bc39ca9b7/packages/fxa-content-server/Dockerfile-build#L19" target="_blank" rel="noopener noreferrer">fxa-content-server-l10n repo is cloned</a> and the build process started.</li><li>The build process starts the <a href="https://github.com/mozilla/fxa/blob/dfc7a258402840e35139fd918c7bc93bc39ca9b7/packages/fxa-content-server/grunttasks/l10n-create-json.js" target="_blank" rel="noopener noreferrer">l10n-create-json grunt task</a>.</li><li>The l10n-create-json task copies all of the translated .po files from the fxa-content-server-l10n repo and runs the <a href="https://github.com/rockykitamura/grunt-po2json/" target="_blank" rel="noopener noreferrer">grunt po2json task</a>, once for each of the 2 .po files for each locale, resulting in 2 .json files for each locale.</li><li>A copy of the compiled JavaScript bundles are created for each locale.<ul><li>For each locale, client.json is injected into the <a href="https://github.com/mozilla/fxa/blob/dfc7a258402840e35139fd918c7bc93bc39ca9b7/packages/fxa-content-server/app/scripts/lib/translator.js#L36" target="_blank" rel="noopener noreferrer">special comment in app/lib/translator.js</a>.</li><li>SRI hashes for any dynamically loaded scripts are <a href="https://github.com/mozilla/fxa/blob/dfc7a258402840e35139fd918c7bc93bc39ca9b7/packages/fxa-content-server/grunttasks/sriify.js#L96" target="_blank" rel="noopener noreferrer">added to the JS</a>.</li></ul></li><li>A copy of the .html templates are created for each locale in <a href="https://github.com/mozilla/fxa/tree/main/packages/fxa-content-server/server/templates/pages" target="_blank" rel="noopener noreferrer">server/templates/pages/dist</a>.<ul><li>The SRI hash of that locale’s JavaScript bundle is <a href="https://github.com/mozilla/fxa/blob/dfc7a258402840e35139fd918c7bc93bc39ca9b7/packages/fxa-content-server/grunttasks/sriify.js#L74" target="_blank" rel="noopener noreferrer">added to the script tag in the HTML</a>.</li></ul></li></ul><h2 class="anchor anchorWithStickyNavbar_y2LR" id="dates-and-times">Dates and Times<a class="hash-link" href="#dates-and-times" title="Direct link to heading">​</a></h2><p>Dates and times are a special case because dates and times are very locale specific. For example, in Europe it is common for July 10 to be written 10/07 whereas that would read October 10th to North Americans. All of our times and dates are translated using the locale-aware version of MomentJS. Since the locale-aware <a href="https://momentjs.com/" target="_blank" rel="noopener noreferrer">MomentJS</a> is rather large (67kb), dates and times displayed in the <a href="https://accounts.firefox.com/settings/clients" target="_blank" rel="noopener noreferrer">Devices &amp; apps panel</a> of FxA are translated on the auth-server when requesting the devices and apps list.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="terms-of-service-and-privacy-policy-are-handled-differently">Terms of Service and Privacy Policy are handled differently<a class="hash-link" href="#terms-of-service-and-privacy-policy-are-handled-differently" title="Direct link to heading">​</a></h2><p>The FxA <a href="https://github.com/mozilla/legal-docs/blob/master/en/firefox_cloud_services_tos.md" target="_blank" rel="noopener noreferrer">Terms of Service</a> and <a href="https://github.com/mozilla/legal-docs/tree/master/firefox_cloud_services_PrivacyNotice" target="_blank" rel="noopener noreferrer">Privacy Policy</a> are handled differently to other FxA translations. The most important difference is that these are considered legally binding documents, as such changes are driven by Mozilla’s legal team and source documents are held in the <a href="https://github.com/mozilla/legal-docs/" target="_blank" rel="noopener noreferrer">mozilla/legal-docs repository</a> on Github. Any time either document is updated, paid specialist legal translators make the updates for other languages.</p><p>Unlike the rest of the FxA translations that are held in gettext .po files, the terms of service and privacy policy source documents are full markdown documents to allow the Legal team control over the formatting of the documents. During the FxA docker image build, the head of the legal-docs repo is pulled in and the markdown documents converted to HTML.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="future-directions--possible-improvements">Future directions / Possible improvements<a class="hash-link" href="#future-directions--possible-improvements" title="Direct link to heading">​</a></h2><ul><li>Send a slack notification or <a href="https://github.com/mozilla/fxa-content-server-l10n/blob/ed36b87ccf22a4420fd7a65ecfd9f6eb89c45c15/scripts/email-dev-l10n.sh#L3" target="_blank" rel="noopener noreferrer">email</a> whenever strings are extracted.</li><li>Notify a mailing list if l10n-lint fails.</li><li>Back out a commit if l10n-lint fails.</li><li>Extract strings more frequently, even up to every commit?<ul><li>Would the l10n team be on board with this? A stated goal was to minimize the number of pings a translator received for any given project to avoid notification burnout.</li></ul></li><li>Strings are only bundled in with the production JS whenever docker images are created. During a normal release, a train is cut and a docker image created on a Monday. The train is then deployed the following Monday. If no new docker images are created in between, then an entire week of translations may not be deployed to production.</li><li>Automate checking Pontoon for newly translated locales. If a locale reaches a certain threshold (we have used 70% in the past), open a PR against the <a href="https://github.com/mozilla/fxa/blob/dfc7a258402840e35139fd918c7bc93bc39ca9b7/packages/fxa-shared/l10n/supportedLanguages.json" target="_blank" rel="noopener noreferrer">supportedLanguages list</a>.</li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/mozilla/ecosystem-platform/edit/main/website/docs/reference/localization.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_mt2f"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/ecosystem-platform/reference/how-does-fxa-process-email"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">How does FxA process email?</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/ecosystem-platform/reference/metrics"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Metrics</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#extraction-process" class="table-of-contents__link toc-highlight">Extraction process</a></li><li><a href="#localization-process" class="table-of-contents__link toc-highlight">Localization process</a></li><li><a href="#import-to-production-process" class="table-of-contents__link toc-highlight">Import to production process</a></li><li><a href="#a-bit-about-gettext" class="table-of-contents__link toc-highlight">A bit about gettext</a><ul><li><a href="#content-server-gotchas" class="table-of-contents__link toc-highlight">Content server gotchas</a></li></ul></li><li><a href="#extraction-process-deep-dive" class="table-of-contents__link toc-highlight">Extraction process deep dive</a></li><li><a href="#import-process-deep-dive" class="table-of-contents__link toc-highlight">Import process deep dive</a></li><li><a href="#dates-and-times" class="table-of-contents__link toc-highlight">Dates and Times</a></li><li><a href="#terms-of-service-and-privacy-policy-are-handled-differently" class="table-of-contents__link toc-highlight">Terms of Service and Privacy Policy are handled differently</a></li><li><a href="#future-directions--possible-improvements" class="table-of-contents__link toc-highlight">Future directions / Possible improvements</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 Mozilla Corporation.</div></div></div></footer></div>
<script src="/ecosystem-platform/assets/js/runtime~main.f96db157.js"></script>
<script src="/ecosystem-platform/assets/js/main.d44bc471.js"></script>
</body>
</html>