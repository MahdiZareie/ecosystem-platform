<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-reference/jwt-access-tokens">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.21">
<link rel="search" type="application/opensearchdescription+xml" title="Firefox Ecosystem Platform" href="/ecosystem-platform/opensearch.xml"><title data-rh="true">JWT Access Tokens | Firefox Ecosystem Platform</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://mozilla.github.io/ecosystem-platform/reference/jwt-access-tokens"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="JWT Access Tokens | Firefox Ecosystem Platform"><meta data-rh="true" name="description" content="Current as of October 17th, 2019"><meta data-rh="true" property="og:description" content="Current as of October 17th, 2019"><link data-rh="true" rel="icon" href="/ecosystem-platform/img/firefox-logo.png"><link data-rh="true" rel="canonical" href="https://mozilla.github.io/ecosystem-platform/reference/jwt-access-tokens"><link data-rh="true" rel="alternate" href="https://mozilla.github.io/ecosystem-platform/reference/jwt-access-tokens" hreflang="en"><link data-rh="true" rel="alternate" href="https://mozilla.github.io/ecosystem-platform/reference/jwt-access-tokens" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://RFM5H13DFK-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/ecosystem-platform/assets/css/styles.58bd7732.css">
<link rel="preload" href="/ecosystem-platform/assets/js/runtime~main.a7df76e2.js" as="script">
<link rel="preload" href="/ecosystem-platform/assets/js/main.0e875d9f.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/ecosystem-platform/"><div class="navbar__logo"><img src="/ecosystem-platform/img/firefox-logo.png" alt="Ecosystem Platform Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/ecosystem-platform/img/firefox-logo.png" alt="Ecosystem Platform Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Firefox Ecosystem Platform</b></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/mozilla/ecosystem-platform" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/ecosystem-platform/">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link">For Relying Parties</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/ecosystem-platform/relying-parties/tutorials/integration-with-fxa">Tutorials</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/ecosystem-platform/relying-parties/how-twos/end-to-end-encryption">How-to Guides</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/ecosystem-platform/relying-parties/reference/metrics-for-relying-parties">Reference</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--active">For FxA Engineers</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/ecosystem-platform/tutorials/development-setup">Tutorials</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/ecosystem-platform/how-tos/creating-an-account-locally">How-to Guides</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/ecosystem-platform/reference/team-processes/development-process">Reference</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/ecosystem-platform/reference/team-processes/development-process">Team Processes</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/ecosystem-platform/reference/style-guides/general-best-practices">Style Guides</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/reference/browser-support">Browser Support</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/reference/incident-response">Incident Response</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/reference/emails">Emails</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/reference/localization">Localization</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/reference/metrics">Metrics</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/reference/token-types">Types of Auth Tokens</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/ecosystem-platform/reference/jwt-access-tokens">JWT Access Tokens</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/reference/storybook-deploys-with-circleci">Storybook Deploys with CircleCI</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/reference/webchannels-in-firefox-desktop-fennec">WebChannels in Firefox Desktop &amp; Fennec</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/reference/webchannels-in-fenix-webextensions">WebChannels in Fenix &amp; WebExtensions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/reference/tests-in-circleci">Tests in CircleCI</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/reference/functional-testing">Functional Tests</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/reference/automation-testplan">Automation Test Plan</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/reference/internal-api-documentation">Internal API Documentation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/reference/experiments-ab-testing">Experiments &amp; A/B Testing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/reference/system-diagrams">System Diagrams</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/reference/application-logging">Application Logging</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/reference/scheduled-maintenance">Scheduled Maintenance</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/reference/mobile-specifics">Mobile Specifics</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/reference/architectural-decision-records">Architectural Decision Records</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/reference/github-strategies">GitHub Strategies</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/reference/third-party-authentication">Third Party Authentication in FxA</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/reference/rate-limiting">Rate limiting</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/reference/using-swagger-for-api-documentation">Using Swagger for API documentation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a href="https://docs.telemetry.mozilla.org/datasets/fxa.html" target="_blank" rel="noopener noreferrer" class="menu__link menuExternalLink_NmtK" tabindex="0">Telemetry Data Docs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/ecosystem-platform/explanation/metrics">Explanation</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/additional-docs">Additional Docs</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link">For Support Agents</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/ecosystem-platform/reference/admin-panel">Reference</a></div></li></ul></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_GujU"><div class="docItemContainer_Adtb"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/ecosystem-platform/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">For FxA Engineers</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Reference</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">JWT Access Tokens</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_aoJ5"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>JWT Access Tokens</h1></header><p>Current as of <code>October 17th, 2019</code></p><p>The <a href="https://tools.ietf.org/html/rfc6749" target="_blank" rel="noopener noreferrer">original OAuth 2.0 spec</a> does not specify a
format for access tokens, most OAuth implementations use fixed length opaque tokens.</p><p>A service provider (SP) that accepts access tokens must verify the token to determine
whether the grant associated with the token has sufficient privileges to access a
protected resource. With opaque tokens, verification involves sending the token to
the remote authorization server (AS)&#x27;s <code>/introspect</code> endpoint. The AS looks up the
token in a database, verifies the token is still valid, and returns associated
metadata such as a userid and list of scopes in the grant. Because verification
involves a request to the AS, verification can introduce unwanted latency.</p><p>The IETF <a href="https://tools.ietf.org/html/draft-bertocci-oauth-access-token-jwt-00" target="_blank" rel="noopener noreferrer">JWT access token draft spec</a>
solves the latency problem by defining a standard access token format that can be verified
locally by the SP, eliminating the need to call remote services on every verification.</p><p><a href="https://tools.ietf.org/html/rfc7519" target="_blank" rel="noopener noreferrer">JWTs are signed JSON packets</a> that can contain
arbitrary information in fields called <code>claims</code> where a claim is a single unit of
information. JWT access tokens are signed with public/private key pairs, and once the
SP fetches the correct public key from the AS, no further remote calls are needed.
JWT access tokens can contain most of the same information as the AS&#x27;s <code>/introspect</code>
endpoint.</p><p>At a high level, a SP that wishes to do local verification of JWT access tokens needs
to verify the header of the token, verify the signature of the token, ensure the token
is not yet expired, and ensure the access token contains the correct claims necessary
to access a protected resource. More information can be found in the section titled
<a href="#local-verification-of-a-jwt-access-token">Local verification of a JWT access token</a>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="claims-within-an-access-token">Claims within an access token<a class="hash-link" href="#claims-within-an-access-token" title="Direct link to heading">​</a></h2><p>Firefox Accounts largely follows the IETF JWT access token draft spec&#x27;s
<a href="https://tools.ietf.org/html/draft-bertocci-oauth-access-token-jwt-00#section-2.2" target="_blank" rel="noopener noreferrer">Data Structure</a>.</p><ul><li><code>aud</code> - audience. By default the <code>client_id</code> of the Relying Party (RP). If a RP specifies
a <a href="https://tools.ietf.org/html/draft-ietf-oauth-resource-indicators-08" target="_blank" rel="noopener noreferrer">Resource Indicator</a> when requesting the access token, it will be an array that contains both the client_id and the resource indicator.</li><li><code>client_id</code> - client id of the RP.</li><li><code>iss</code> - issuer. For tokens that come from FxA&#x27;s production stack this will be <code>https://accounts.firefox.com</code></li><li><code>exp</code> - expiration time after which the access token MUST NOT be accepted for processing, in <em>seconds</em> since Unix epoch.</li><li><code>iat</code> - time at which the token was issued, in <em>seconds</em> since Unix epoch.</li><li><code>jti</code> - JWT id</li><li><code>scope</code> - space separated list of scopes associated with the grant.</li><li><code>sub</code> - subject, user id. Normally the FxA user id for the user. If the RP uses <a href="https://github.com/mozilla/fxa/blob/main/packages/fxa-auth-server/fxa-oauth-server/docs/pairwise-pseudonymous-identifiers.md" target="_blank" rel="noopener noreferrer">Pairwise Pseudonymous Identifiers (PPID)</a>, will be an identifier that cannot be correlated to either the real FxA userid, or the PPID given out to other RPs.</li><li><code>fxa-subscriptions</code> - space separated list of subscriptions the user has for the RP. Claim is only present if the user has a subscription with the RP.</li></ul><p>Internal Mozilla reliers also have access to the following custom claims:</p><ul><li><code>fxa-generation</code>: A number that increases each time the user&#x27;s password is changed.
Reliers can use this value to reject JWTs that were created before the password change,
by tracking the largest-seen <code>fxa-generation</code> claim for each user and rejecting tokens
that have smaller values.</li><li><code>fxa-profileChangedAt</code>: A timestamp that increases each time the user&#x27;s core profile data
is changed. Reliers can use this value to refresh cached profile data in a timely manner.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="local-verification-of-a-jwt-access-token">Local verification of a JWT access token<a class="hash-link" href="#local-verification-of-a-jwt-access-token" title="Direct link to heading">​</a></h2><p>The following is based on the <a href="https://tools.ietf.org/html/draft-bertocci-oauth-access-token-jwt-00#section-4" target="_blank" rel="noopener noreferrer">section on validation</a> JWT Access Token Draft Spec:</p><ol><li>The resource server MUST verify that the <code>typ</code> header value is
<code>at+jwt</code> and reject tokens carrying any other value.</li><li>The resource server MUST validate the signature of all incoming
JWT access token according to <a href="https://tools.ietf.org/html/rfc7515" target="_blank" rel="noopener noreferrer">RFC7515</a> using the algorithm
specified in the JWT <code>alg</code> Header Parameter. The SP MUST use the keys provided
at <a href="https://oauth.accounts.firefox.com/v1/jwks" target="_blank" rel="noopener noreferrer">https://oauth.accounts.firefox.com/v1/jwks</a></li><li>The <code>iss</code> claim MUST exactly match <code>https://accounts.firefox.com</code></li><li>The resource server MUST validate that the <code>aud</code> claim contains the
resource indicator value corresponding to the identifier the
resource server expects for itself, and should at a minimum contain
the client_id for the RP. The <code>aud</code> claim MAY contain an
array with more than one element. The JWT access token MUST be
rejected if <code>aud</code> does not list the resource indicator of the
current resource server as a valid audience, or if it contains
additional audiences that are not known aliases of the resource
indicator of the current resource server.</li><li>The current time MUST be before the time represented by the <code>exp</code>
Claim. <code>exp</code> is in <em>seconds</em> since Unix epoch.</li><li>The <code>scope</code> claim must contain the scopes necessary to access a protected resource.</li><li>If the protected resource requires a subscription, check the <code>fxa-subscriptions</code> claim
for the expected subscription capability. More information on why the <code>fxa-subscriptions</code>
claim is used instead of adding subscriptions onto the <code>scope</code> claim, please see
<a href="https://github.com/mozilla/fxa/blob/main/docs/adr/0007-subscription-claim-jwt-access-token.md" target="_blank" rel="noopener noreferrer">this explanation</a>.</li></ol><p>Libraries such as <a href="https://github.com/auth0/node-jsonwebtoken/" target="_blank" rel="noopener noreferrer">node-jsonwebtoken</a>, when properly configured, take
care of all of this except for the <code>scope</code> and <code>fxa-subscriptions</code> checks.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="remote-verification-of-a-jwt-access-token">Remote verification of a JWT access token<a class="hash-link" href="#remote-verification-of-a-jwt-access-token" title="Direct link to heading">​</a></h2><p>A SP is not required to locally verify JWT access tokens, instead it may verify
these tokens by presenting them to FxA&#x27;s <a href="https://github.com/mozilla/fxa/blob/main/packages/fxa-auth-server/fxa-oauth-server/docs/api.md#post-v1introspect" target="_blank" rel="noopener noreferrer">/introspect</a>
and <a href="https://github.com/mozilla/fxa/blob/main/packages/fxa-auth-server/fxa-oauth-server/docs/api.md#post-v1verify" target="_blank" rel="noopener noreferrer">/verify</a> endpoints.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="pitfalls-of-jwt-access-tokens">Pitfalls of JWT access tokens<a class="hash-link" href="#pitfalls-of-jwt-access-tokens" title="Direct link to heading">​</a></h2><p>While FxA JWT access tokens allow for local verification, they do have some drawbacks.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="access-token-size">Access token size<a class="hash-link" href="#access-token-size" title="Direct link to heading">​</a></h3><p>The most obvious drawback is size, a JWT access token is <a href="https://github.com/mozilla/fxa/issues/1797" target="_blank" rel="noopener noreferrer">requires over 800 bytes</a>
whereas a normal access token requires 64 bytes. JWT access tokens that are
sent with every request could add significant overhead.</p><p>JWT access tokens are signed using RSA keys, which generate large signatures. Changing
to a <a href="https://github.com/mozilla/fxa/pull/1918" target="_blank" rel="noopener noreferrer">different key type</a> would reduce the signature size.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="revocation-and-cached-tokens">Revocation and cached tokens<a class="hash-link" href="#revocation-and-cached-tokens" title="Direct link to heading">​</a></h3><p>A second, more subtle issue comes with local verification and revocation. When a
token is verified against FxA servers, FxA is able to look up whether that token has
been revoked by the user and immediately notify the SP the token is no longer valid.
SPs that cache and locally verify JWT access tokens have no way of knowing whether
the token has been revoked, they can only determine whether a token has expired.
Because tokens expire 24 to 48 hours after they are created (depending on FxA server load),
an SP could consider a token valid long after it has been revoked by the user.</p><p>Two mechanisms exist to partially mitigate this:</p><ul><li>Perform an occasional remote verification against the <code>/introspect</code> endpoint.</li><li>When trading the code for the token, specify a short <code>ttl</code>. Whenever the refresh token
is used to fetch a new access token, the <code>/token</code> endpoint will return a 4xx error indicating
the refresh token has been revoked.</li></ul><p>In the future, FxA may <a href="https://github.com/mozilla/fxa/issues/2246" target="_blank" rel="noopener noreferrer">send notifications to SPs</a> whenever
an access or refresh token is revoked, but this functionality is not yet built.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="requesting-use-of-jwt-access-tokens">Requesting use of JWT access tokens<a class="hash-link" href="#requesting-use-of-jwt-access-tokens" title="Direct link to heading">​</a></h2><p>JWT access tokens are only enabled for RPs on an opt-in basis. RPs can request JWT access
tokens when their OAuth credentials are being provisioned.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/mozilla/ecosystem-platform/edit/master/docs/reference/jwt-access-tokens.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_eYIM" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vbeJ"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/ecosystem-platform/reference/token-types"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Types of Auth Tokens</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/ecosystem-platform/reference/storybook-deploys-with-circleci"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Storybook Deploys with CircleCI</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#claims-within-an-access-token" class="table-of-contents__link toc-highlight">Claims within an access token</a></li><li><a href="#local-verification-of-a-jwt-access-token" class="table-of-contents__link toc-highlight">Local verification of a JWT access token</a></li><li><a href="#remote-verification-of-a-jwt-access-token" class="table-of-contents__link toc-highlight">Remote verification of a JWT access token</a></li><li><a href="#pitfalls-of-jwt-access-tokens" class="table-of-contents__link toc-highlight">Pitfalls of JWT access tokens</a><ul><li><a href="#access-token-size" class="table-of-contents__link toc-highlight">Access token size</a></li><li><a href="#revocation-and-cached-tokens" class="table-of-contents__link toc-highlight">Revocation and cached tokens</a></li></ul></li><li><a href="#requesting-use-of-jwt-access-tokens" class="table-of-contents__link toc-highlight">Requesting use of JWT access tokens</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 Mozilla Corporation.</div></div></div></footer></div>
<script src="/ecosystem-platform/assets/js/runtime~main.a7df76e2.js"></script>
<script src="/ecosystem-platform/assets/js/main.0e875d9f.js"></script>
</body>
</html>